<!-- System Components Overview -->
<!-- LLM Chat RAG System - Architecture Overview -->
<!-- Format: draw.io XML -->

<mxfile host="app.diagrams.net">
  <diagram name="System Components Overview" id="system-components-overview">
    <mxGraphModel dx="2000" dy="1200" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="2400" pageHeight="1800" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Title -->
        <mxCell id="title" value="ðŸ—ï¸ System Components Overview - LLM Chat RAG System" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=28;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="600" y="20" width="1200" height="50" as="geometry" />
        </mxCell>

        <!-- User -->
        <mxCell id="user" value="ðŸ‘¤ User" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1f5ff;strokeColor=#01579b;strokeWidth=3;fontSize=16" vertex="1" parent="1">
          <mxGeometry x="100" y="120" width="150" height="80" as="geometry" />
        </mxCell>

        <!-- Channel Selection -->
        <mxCell id="channel" value="ðŸ“± Channel Selection" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff9c4;strokeColor=#f57f17;strokeWidth=2;fontSize=14" vertex="1" parent="1">
          <mxGeometry x="100" y="250" width="150" height="100" as="geometry" />
        </mxCell>

        <!-- Entry Channels -->
        <mxCell id="channel-title" value="Entry Channels" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="350" y="220" width="200" height="30" as="geometry" />
        </mxCell>

        <mxCell id="web-pwa" value="ðŸŒ Web/PWA&#xa;Frontend SPA&#xa;SPA Routing&#xa;Vite + Bootstrap" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1f5ff;strokeColor=#01579b;strokeWidth=2;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="350" y="260" width="200" height="100" as="geometry" />
        </mxCell>

        <mxCell id="line" value="ðŸ’¬ LINE&#xa;Official Account&#xa;@61582704027978&#xa;LINE Bot SDK" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1f5ff;strokeColor=#01579b;strokeWidth=2;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="600" y="260" width="200" height="100" as="geometry" />
        </mxCell>

        <mxCell id="facebook" value="ðŸ“˜ Facebook&#xa;Messenger&#xa;(Ready but inactive)&#xa;Graph API" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1f5ff;strokeColor=#01579b;strokeWidth=2;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="850" y="260" width="200" height="100" as="geometry" />
        </mxCell>

        <mxCell id="telegram" value="ðŸ“± Telegram&#xa;Bot&#xa;(Ready)&#xa;Bot API" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1f5ff;strokeColor=#01579b;strokeWidth=2;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="1100" y="260" width="200" height="100" as="geometry" />
        </mxCell>

        <!-- Cloudflare Tunnel -->
        <mxCell id="cloudflare" value="â˜ï¸ Cloudflare Tunnel&#xa;Secure Ingress&#xa;HTTPS â†’ HTTP&#xa;DDoS Protection" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff3e0;strokeColor=#e65100;strokeWidth=2;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="600" y="420" width="200" height="100" as="geometry" />
        </mxCell>

        <!-- Messaging Gateway -->
        <mxCell id="messaging-gateway" value="ðŸ’¬ Messaging Gateway&#xa;Message Normalization&#xa;Session Mapping&#xa;Platform Integration" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f3e5f5;strokeColor=#4a148c;strokeWidth=2;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="600" y="580" width="200" height="100" as="geometry" />
        </mxCell>

        <!-- LLM Chat API -->
        <mxCell id="llm-api" value="ðŸš€ LLM Chat API&#xa;Express.js + Node.js&#xa;RESTful API&#xa;Business Logic" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f3e5f5;strokeColor=#4a148c;strokeWidth=2;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="600" y="740" width="200" height="100" as="geometry" />
        </mxCell>

        <!-- RAG Pipeline -->
        <mxCell id="rag-title" value="RAG Pipeline (Retrieval-Augmented Generation)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="100" y="900" width="400" height="30" as="geometry" />
        </mxCell>

        <mxCell id="query-embedding" value="1ï¸âƒ£ Query Embedding&#xa;Convert User Query&#xa;to Vector (1536-d)&#xa;Ollama API" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fce4ec;strokeColor=#880e4f;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="100" y="950" width="180" height="100" as="geometry" />
        </mxCell>

        <mxCell id="vector-search" value="2ï¸âƒ£ Vector Search&#xa;pgvector Similarity&#xa;Cosine Distance&#xa;Top 10 Results" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fce4ec;strokeColor=#880e4f;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="320" y="950" width="180" height="100" as="geometry" />
        </mxCell>

        <mxCell id="context-build" value="3ï¸âƒ£ Context Building&#xa;Persona Prompt&#xa;+ Conversation History&#xa;+ Business Data" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fce4ec;strokeColor=#880e4f;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="540" y="950" width="180" height="100" as="geometry" />
        </mxCell>

        <!-- Data Storage -->
        <mxCell id="data-title" value="Data Storage" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="900" y="900" width="200" height="30" as="geometry" />
        </mxCell>

        <mxCell id="postgres" value="ðŸ—„ï¸ PostgreSQL&#xa;+ pgvector Extension&#xa;Vector Storage&#xa;ACID Compliance" style="cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#fff9c4;strokeColor=#f57f17;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="900" y="950" width="200" height="120" as="geometry" />
        </mxCell>

        <mxCell id="redis" value="âš¡ Redis&#xa;In-Memory Cache&#xa;BullMQ Backend&#xa;Session Store" style="cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#fff9c4;strokeColor=#f57f17;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="1150" y="950" width="200" height="120" as="geometry" />
        </mxCell>

        <!-- AI Services -->
        <mxCell id="ai-title" value="AI Services" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="100" y="1120" width="200" height="30" as="geometry" />
        </mxCell>

        <mxCell id="ollama-llm" value="ðŸ¤– Ollama LLM&#xa;Model: llama3.2 (7B)&#xa;Local LLM&#xa;Text Generation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fce4ec;strokeColor=#880e4f;strokeWidth=2;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="100" y="1170" width="200" height="100" as="geometry" />
        </mxCell>

        <mxCell id="embedding-service" value="ðŸ“Š Embedding Service&#xa;Vector Generation&#xa;1536 Dimensions&#xa;Ollama API" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fce4ec;strokeColor=#880e4f;strokeWidth=2;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="350" y="1170" width="200" height="100" as="geometry" />
        </mxCell>

        <!-- Background Jobs -->
        <mxCell id="jobs-title" value="Background Jobs" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="600" y="1120" width="200" height="30" as="geometry" />
        </mxCell>

        <mxCell id="bullmq-worker" value="âš™ï¸ BullMQ Worker&#xa;Async Job Processing&#xa;Embedding Generation&#xa;Retry Logic" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8f5e9;strokeColor=#1b5e20;strokeWidth=2;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="600" y="1170" width="200" height="100" as="geometry" />
        </mxCell>

        <mxCell id="redis-queue" value="ðŸ“‹ Redis Queue&#xa;Job Storage&#xa;BullMQ Backend&#xa;Job History" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8f5e9;strokeColor=#1b5e20;strokeWidth=2;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="850" y="1170" width="200" height="100" as="geometry" />
        </mxCell>

        <!-- Response Streaming -->
        <mxCell id="response-title" value="Response Streaming" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1100" y="1120" width="200" height="30" as="geometry" />
        </mxCell>

        <mxCell id="sse" value="ðŸ“¡ SSE&#xa;Server-Sent Events&#xa;Real-time Streaming&#xa;Web Channel" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e0f2f1;strokeColor=#004d40;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="1100" y="1170" width="150" height="80" as="geometry" />
        </mxCell>

        <mxCell id="line-api" value="ðŸ’¬ LINE API&#xa;Push/Reply Message&#xa;2000 char limit&#xa;LINE Bot SDK" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e0f2f1;strokeColor=#004d40;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="1270" y="1170" width="150" height="80" as="geometry" />
        </mxCell>

        <!-- Arrows -->
        <!-- User to Channel -->
        <mxCell id="arrow-user-channel" value="Select Channel" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=11" edge="1" parent="1" source="user" target="channel">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Channel to Entry Points -->
        <mxCell id="arrow-channel-web" value="Web/PWA" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="channel" target="web-pwa">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow-channel-line" value="LINE" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="channel" target="line">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow-channel-facebook" value="Facebook" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="channel" target="facebook">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow-channel-telegram" value="Telegram" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="channel" target="telegram">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Entry Points to Tunnel -->
        <mxCell id="arrow-web-tunnel" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="web-pwa" target="cloudflare">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow-line-tunnel" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="line" target="cloudflare">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow-facebook-tunnel" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="facebook" target="cloudflare">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow-telegram-tunnel" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="telegram" target="cloudflare">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Tunnel to Gateway -->
        <mxCell id="arrow-tunnel-gateway" value="Proxy" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="cloudflare" target="messaging-gateway">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Gateway to API -->
        <mxCell id="arrow-gateway-api" value="Normalize &amp; Route" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="messaging-gateway" target="llm-api">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- API to RAG -->
        <mxCell id="arrow-api-rag" value="Process Request" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="llm-api" target="query-embedding">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- RAG Pipeline Flow -->
        <mxCell id="arrow-embed-search" value="Query Vector" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="query-embedding" target="vector-search">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow-search-context" value="Similar Results" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="vector-search" target="context-build">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- API to Database -->
        <mxCell id="arrow-api-postgres" value="Query Data" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="llm-api" target="postgres">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow-api-redis" value="Queue Jobs" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="llm-api" target="redis">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- API to AI Services -->
        <mxCell id="arrow-api-ollama" value="Generate Response" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="llm-api" target="ollama-llm">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow-api-embedding" value="Generate Embedding" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="llm-api" target="embedding-service">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Worker Flow -->
        <mxCell id="arrow-worker-queue" value="Pull Jobs" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="bullmq-worker" target="redis-queue">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow-worker-embedding" value="Create Embeddings" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="bullmq-worker" target="embedding-service">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow-worker-postgres" value="Update Vectors" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="bullmq-worker" target="postgres">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Response Streaming -->
        <mxCell id="arrow-api-sse" value="Stream Response" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="llm-api" target="sse">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow-api-line" value="Send Message" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="llm-api" target="line-api">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Embedding Service to Postgres -->
        <mxCell id="arrow-embed-postgres" value="Store Vectors" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="embedding-service" target="postgres">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Vector Search to Postgres -->
        <mxCell id="arrow-search-postgres" value="pgvector Query" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="vector-search" target="postgres">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>


