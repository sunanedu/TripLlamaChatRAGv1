<!-- Deployment Diagram -->
<!-- LLM Chat System - Production Deployment Architecture -->
<!-- Format: draw.io XML -->

<mxfile host="app.diagrams.net">
  <diagram name="Deployment Diagram" id="deployment-diagram">
    <mxGraphModel dx="2000" dy="1200" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="2400" pageHeight="1600" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Title -->
        <mxCell id="title" value="ðŸš€ Deployment Diagram - LLM Chat System" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=28;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="800" y="20" width="800" height="50" as="geometry" />
        </mxCell>

        <!-- Internet -->
        <mxCell id="internet" value="ðŸŒ Internet&#xa;Public Access" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1f5ff;strokeColor=#01579b;strokeWidth=3;fontSize=16" vertex="1" parent="1">
          <mxGeometry x="100" y="120" width="300" height="80" as="geometry" />
        </mxCell>

        <!-- Cloudflare Tunnels -->
        <mxCell id="cloudflare-title" value="â˜ï¸ Cloudflare Tunnels" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="500" y="90" width="300" height="30" as="geometry" />
        </mxCell>

        <mxCell id="cf-frontend" value="ðŸŒ Frontend Tunnel&#xa;frontend.sri-ketguide.com&#xa;Container: cf-tunnel-frontend" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff3e0;strokeColor=#e65100;strokeWidth=2;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="450" y="130" width="200" height="100" as="geometry" />
        </mxCell>

        <mxCell id="cf-api" value="ðŸš€ API Tunnel&#xa;api.sri-ketguide.com&#xa;Container: cf-tunnel-api" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff3e0;strokeColor=#e65100;strokeWidth=2;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="700" y="130" width="200" height="100" as="geometry" />
        </mxCell>

        <mxCell id="cf-pwa" value="ðŸ“± PWA Tunnel&#xa;pwa.sri-ketguide.com&#xa;Container: cf-tunnel-prod" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff3e0;strokeColor=#e65100;strokeWidth=2;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="950" y="130" width="200" height="100" as="geometry" />
        </mxCell>

        <mxCell id="cf-webhooks" value="ðŸ”” Webhooks Tunnel&#xa;webhooks.sri-ketguide.com&#xa;Container: cf-tunnel-webhooks" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff3e0;strokeColor=#e65100;strokeWidth=2;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="1200" y="130" width="200" height="100" as="geometry" />
        </mxCell>

        <!-- Docker Network -->
        <mxCell id="docker-network-title" value="ðŸ³ Docker Network (llm-chat-network)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="200" y="280" width="800" height="30" as="geometry" />
        </mxCell>

        <!-- Frontend Services -->
        <mxCell id="frontend-title" value="Frontend Layer" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="200" y="330" width="150" height="20" as="geometry" />
        </mxCell>

        <mxCell id="frontend" value="ðŸŒ Frontend SPA&#xa;Container: sri_prod-llm-chat-frontend-1&#xa;Port: 80&#xa;Nginx + Vite Build" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1f5ff;strokeColor=#01579b;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="200" y="360" width="220" height="120" as="geometry" />
        </mxCell>

        <mxCell id="pwa" value="ðŸ“± PWA App&#xa;Container: sri_prod-llm-chat-pwa-1&#xa;Port: 80&#xa;Progressive Web App" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1f5ff;strokeColor=#01579b;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="450" y="360" width="220" height="120" as="geometry" />
        </mxCell>

        <!-- Application Layer -->
        <mxCell id="app-title" value="Application Layer" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="200" y="520" width="150" height="20" as="geometry" />
        </mxCell>

        <mxCell id="api" value="ðŸš€ LLM Chat API&#xa;Container: sri_prod-llm-chat-api-1&#xa;Port: 3000&#xa;Express.js + Node.js" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f3e5f5;strokeColor=#4a148c;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="200" y="550" width="220" height="120" as="geometry" />
        </mxCell>

        <mxCell id="messaging-gateway" value="ðŸ’¬ Messaging Gateway&#xa;Container: messaging-gateway&#xa;Port: 8080&#xa;LINE/FB/Telegram Integration" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f3e5f5;strokeColor=#4a148c;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="450" y="550" width="220" height="120" as="geometry" />
        </mxCell>

        <mxCell id="worker" value="âš™ï¸ BullMQ Worker&#xa;Container: sri_prod-llm-chat-worker-1&#xa;Background Jobs&#xa;Embedding Generation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f3e5f5;strokeColor=#4a148c;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="700" y="550" width="220" height="120" as="geometry" />
        </mxCell>

        <!-- Data Layer -->
        <mxCell id="data-title" value="Data Layer" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="200" y="710" width="150" height="20" as="geometry" />
        </mxCell>

        <mxCell id="postgres" value="ðŸ—„ï¸ PostgreSQL&#xa;Container: sri_prod-llm-chat-database-1&#xa;Port: 5432&#xa;+ pgvector Extension&#xa;&#xa;Volume: vit_postgres_data" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff9c4;strokeColor=#f57f17;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="200" y="740" width="220" height="140" as="geometry" />
        </mxCell>

        <mxCell id="redis" value="âš¡ Redis Cache&#xa;Container: sri_prod-llm-chat-cache-1&#xa;Port: 6379&#xa;BullMQ Queue Backend&#xa;&#xa;Volume: redis_data" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff9c4;strokeColor=#f57f17;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="450" y="740" width="220" height="140" as="geometry" />
        </mxCell>

        <!-- AI Services -->
        <mxCell id="ai-title" value="AI Services" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="700" y="710" width="150" height="20" as="geometry" />
        </mxCell>

        <mxCell id="ollama" value="ðŸ¤– Ollama LLM&#xa;Container: sri_prod-llm-chat-embedder-1&#xa;Port: 11434 (generate)&#xa;Port: 11400 (embeddings)&#xa;Model: llama3.2 (7B)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fce4ec;strokeColor=#880e4f;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="700" y="740" width="220" height="140" as="geometry" />
        </mxCell>

        <!-- Database Tables -->
        <mxCell id="tables-title" value="Database Tables" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1000" y="330" width="150" height="20" as="geometry" />
        </mxCell>

        <mxCell id="table-users" value="ðŸ‘¥ users&#xa;â€¢ email&#xa;â€¢ password_hash&#xa;â€¢ role&#xa;â€¢ is_suspended" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e0f2f1;strokeColor=#004d40;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="1000" y="360" width="180" height="100" as="geometry" />
        </mxCell>

        <mxCell id="table-chat-sessions" value="ðŸ“ chat_sessions&#xa;â€¢ id&#xa;â€¢ user_id&#xa;â€¢ title&#xa;â€¢ created_at" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e0f2f1;strokeColor=#004d40;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="1000" y="480" width="180" height="100" as="geometry" />
        </mxCell>

        <mxCell id="table-chat-messages" value="ðŸ’¬ chat_messages&#xa;â€¢ id&#xa;â€¢ session_id&#xa;â€¢ role&#xa;â€¢ content" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e0f2f1;strokeColor=#004d40;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="1000" y="600" width="180" height="100" as="geometry" />
        </mxCell>

        <mxCell id="table-businesses" value="ðŸ¢ businesses&#xa;â€¢ id&#xa;â€¢ name&#xa;â€¢ description&#xa;â€¢ embedding (vector)&#xa;â€¢ embedding_status" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e0f2f1;strokeColor=#004d40;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="1000" y="720" width="180" height="120" as="geometry" />
        </mxCell>

        <!-- Arrows -->
        <!-- Internet to Tunnels -->
        <mxCell id="arrow-internet-frontend" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="internet" target="cf-frontend">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow-internet-api" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="internet" target="cf-api">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow-internet-pwa" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="internet" target="cf-pwa">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow-internet-webhooks" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="internet" target="cf-webhooks">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Tunnels to Services -->
        <mxCell id="arrow-cf-frontend" value="HTTPS â†’ HTTP" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="cf-frontend" target="frontend">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow-cf-pwa" value="HTTPS â†’ HTTP" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="cf-pwa" target="pwa">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow-cf-api" value="HTTPS â†’ HTTP" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="cf-api" target="api">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow-cf-webhooks" value="HTTPS â†’ HTTP" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="cf-webhooks" target="messaging-gateway">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Frontend to API -->
        <mxCell id="arrow-frontend-api" value="POST /api/*" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="frontend" target="api">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- API to Database -->
        <mxCell id="arrow-api-db" value="Sequelize ORM" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="api" target="postgres">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- API to Redis -->
        <mxCell id="arrow-api-redis" value="BullMQ Queue" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="api" target="redis">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- API to Ollama -->
        <mxCell id="arrow-api-ollama" value="POST /api/generate" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="api" target="ollama">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Worker to Redis -->
        <mxCell id="arrow-worker-redis" value="Pull Jobs" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="worker" target="redis">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Worker to Database -->
        <mxCell id="arrow-worker-db" value="Update Embeddings" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="worker" target="postgres">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Worker to Ollama -->
        <mxCell id="arrow-worker-ollama" value="POST /embeddings" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="worker" target="ollama">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Messaging Gateway to API -->
        <mxCell id="arrow-gateway-api" value="POST /api/internal/messaging-gateway" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="messaging-gateway" target="api">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Database to Tables -->
        <mxCell id="arrow-db-users" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="postgres" target="table-users">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow-db-sessions" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="postgres" target="table-chat-sessions">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow-db-messages" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="postgres" target="table-chat-messages">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow-db-businesses" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10" edge="1" parent="1" source="postgres" target="table-businesses">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Legend -->
        <mxCell id="legend-title" value="Legend" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1300" y="330" width="100" height="20" as="geometry" />
        </mxCell>

        <mxCell id="legend-frontend" value="Frontend" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1f5ff;strokeColor=#01579b;strokeWidth=2;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="1300" y="360" width="120" height="30" as="geometry" />
        </mxCell>

        <mxCell id="legend-api" value="Application" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f3e5f5;strokeColor=#4a148c;strokeWidth=2;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="1300" y="400" width="120" height="30" as="geometry" />
        </mxCell>

        <mxCell id="legend-data" value="Data Layer" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff9c4;strokeColor=#f57f17;strokeWidth=2;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="1300" y="440" width="120" height="30" as="geometry" />
        </mxCell>

        <mxCell id="legend-ai" value="AI Services" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fce4ec;strokeColor=#880e4f;strokeWidth=2;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="1300" y="480" width="120" height="30" as="geometry" />
        </mxCell>

        <mxCell id="legend-tunnel" value="Cloudflare" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff3e0;strokeColor=#e65100;strokeWidth=2;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="1300" y="520" width="120" height="30" as="geometry" />
        </mxCell>

        <mxCell id="legend-tables" value="Database Tables" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e0f2f1;strokeColor=#004d40;strokeWidth=2;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="1300" y="560" width="120" height="30" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>

