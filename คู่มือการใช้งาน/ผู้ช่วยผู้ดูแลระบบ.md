# คู่มือการใช้งานระบบ SRI-KETGUIDE สำหรับผู้ช่วยผู้ดูแลระบบ (Staff/Admin)

## สารบัญ
1. [การเข้าสู่ระบบ](#1-การเข้าสู่ระบบ)
2. [หน้าหลัก Admin Panel](#2-หน้าหลัก-admin-panel)
3. [จัดการธุรกิจ](#3-จัดการธุรกิจ)
4. [จัดการผู้ใช้](#4-จัดการผู้ใช้)
5. [จัดการแพ็กเกจ](#5-จัดการแพ็กเกจ)
6. [สลิปการชำระเงิน](#6-สลิปการชำระเงิน)
7. [การจัดการรูปภาพธุรกิจ](#7-การจัดการรูปภาพธุรกิจ)
8. [การสร้าง Embedding](#8-การสร้าง-embedding)
9. [การจัดการ Transaction](#9-การจัดการ-transaction)
10. [คำสั่งและ Path ที่เกี่ยวข้อง](#10-คำสั่งและ-path-ที่เกี่ยวข้อง)
11. [คำเตือนและข้อควรระวัง](#11-คำเตือนและข้อควรระวัง)

---

## 1. การเข้าสู่ระบบ

### 1.1 หน้าล็อกอิน

```
+-------------------------------------------------------------------+
|                                                                   |
|                     SRI-KETGUIDE                                  |
|           ระบบประชาสัมพันธ์การท่องเที่ยวอัจฉริยะ                    |
|                                                                   |
|  +----------------------------------------------------------+     |
|  |                                                          |     |
|  |   อีเมล: [____________________________]                   |     |
|  |                                                          |     |
|  |   รหัสผ่าน: [____________________________]                |     |
|  |                                                          |     |
|  |              [  เข้าสู่ระบบ  ]                             |     |
|  |                                                          |     |
|  |   [ ] จดจำการเข้าสู่ระบบ                                   |     |
|  |                                                          |     |
|  |   ลืมรหัสผ่าน?                                          |     |
|  |                                                          |     |
|  +----------------------------------------------------------+     |
|                                                                   |
|  URL: https://frontend.sri-ketguide.com/#/login                |
|                                                                   |
+-------------------------------------------------------------------+
```

### 1.2 วิธีการเข้าสู่ระบบ

1. เปิดเว็บเบราว์เซอร์และไปที่ URL: `https://frontend.sri-ketguide.com/#/login`
2. กรอกข้อมูลเข้าสู่ระบบ:
   - **อีเมล**: กรอกอีเมลที่ได้จากผู้ดูแลระบบ
   - **รหัสผ่าน**: กรอกรหัสผ่านที่ได้รับ
3. คลิกปุ่ม **"เข้าสู่ระบบ"** หรือกด Enter
4. หากต้องการให้ระบบจำการเข้าสู่ระบบ ให้เลือก **"จดจำการเข้าสู่ระบบ"**

### 1.3 บัญชีผู้ใช้งานที่แนะนำ

**สำหรับ Staff:**
- อีเมล: `staff@example.com`
- รหัสผ่าน: `1234`

**สำหรับ Admin:**
- อีเมล: `admin@example.com`
- รหัสผ่าน: `1234`

### 1.4 ข้อควรระวังในการล็อกอิน

⚠️ **คำเตือน:**
- อย่าแชร์ข้อมูลการเข้าสู่ระบบกับผู้อื่น
- ออกจากระบบเมื่อเสร็จสิ้นการทำงาน
- ไม่ควรเลือก "จดจำการเข้าสู่ระบบ" เมื่อใช้คอมพิวเตอร์สาธารณะ
- หากลืมรหัสผ่าน ให้ติดต่อผู้ดูแลระบบหลัก

---

## 2. หน้าหลัก Admin Panel

### 2.1 ภาพหน้าจอ Admin Panel

```
+-------------------------------------------------------------------+
|  ┌───────────────────────────────────────────────────────────┐  |
|  │  SRI-KETGUIDE                           [Search] [Logout]  │  |
|  └───────────────────────────────────────────────────────────┘  |
|                                                                   |
|  ┌───────────────────────────────────────────────────────────┐  |
|  │  [Chat]  [Staff Panel]  [Sponsor Panel]  [Admin Panel]     │  |
|  └───────────────────────────────────────────────────────────┘  |
|                                                                   |
|  ┌───────────────────────────────────────────────────────────┐  |
|  │  ╔═══════════════════════════════════════════════════════╗ │  |
|  │  ║  🛡️  Admin Panel                                    ║ │  |
|  │  ║     จัดการระบบทั้งหมด                                 ║ │  |
|  │  ╚═══════════════════════════════════════════════════════╝ │  |
|  └───────────────────────────────────────────────────────────┘  |
|                                                                   |
|  ┌───────────────────────────────────────────────────────────┐  |
|  │  📋 แท็บการจัดการ:                                         │  |
|  │  ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌──────────┐ │  |
|  │  │ 🏪 จัดการ   │ │ 👥 จัดการ   │ │ 📦 จัดการ   │ │ 💰 สลิป │ │  |
|  │  │ ธุรกิจ (15) │ │ ผู้ใช้ (10)│ │ แพ็กเกจ (3)│ │ (5)      │ │  |
|  │  └────────────┘ └────────────┘ └────────────┘ └──────────┘ │  |
|  └───────────────────────────────────────────────────────────┘  |
|                                                                   |
+-------------------------------------------------------------------+
```

### 2.2 องค์ประกอบของหน้า Admin Panel

หน้าหลัก Admin Panel ประกอบด้วย:

1. **แถบนำทาง (Navigation Bar)**
   - Logo และชื่อระบบ
   - เมนู: Chat, Staff Panel, Sponsor Panel, Admin Panel
   - ช่องค้นหา
   - ปุ่มออกจากระบบ

2. **แถบแท็บ (Tab Bar)**
   - 🏪 จัดการธุรกิจ (Businesses)
   - 👥 จัดการผู้ใช้ (Users)
   - 📦 จัดการแพ็กเกจ (Packages)
   - 💰 สลิปการชำระเงิน (Payment Slips)

3. **พื้นที่แสดงข้อมูล (Content Area)**
   - แสดงข้อมูลตามแท็บที่เลือก
   - ตารางข้อมูลพร้อมปุ่มจัดการ

### 2.3 การใช้งานแท็บ

1. คลิกที่แท็บที่ต้องการเพื่อเปลี่ยนส่วนการจัดการ
2. ตัวเลขในวงเล็บแสดงจำนวนรายการทั้งหมด
3. แท็บที่เลือกอยู่จะมีสีน้ำเงินและขีดเส้นใต้

---

## 3. จัดการธุรกิจ

### 3.1 หน้าจัดการธุรกิจ

```
+-------------------------------------------------------------------+
|  🏪 จัดการธุรกิจ                          [+ เพิ่มธุรกิจ]         |
|  ┌─────────────────────────────────────────────────────────┐     |
|  │ ชื่อธุรกิจ    │ ประเภท   │ สถานะ  │ การจัดการ           │     |
|  ├───────────────┼──────────┼────────┼────────────────────│     |
|  │ โรงแรมบาบาราย  │ โรงแรม  │ ✅เปิด  │ [แก้] [ลบ] [รูป] │     |
|  │ Better Sweet │ ร้านกาแฟ│ ✅เปิด  │ [แก้] [ลบ] [รูป] │     |
|  │ Cafe         │         │        │                    │     |
|  └───────────────┴──────────┴────────┴────────────────────┘     |
+-------------------------------------------------------------------+
```

### 3.2 ฟีเจอร์การจัดการธุรกิจ

#### 3.2.1 การเพิ่มธุรกิจ

**ขั้นตอนการเพิ่มธุรกิจ:**

1. คลิกปุ่ม **"+ เพิ่มธุรกิจ"** ที่มุมขวาบน
2. กรอกข้อมูลในฟอร์ม:

```
+-------------------------------------------------------------------+
|                  เพิ่มธุรกิจใหม่                                   |
|  ┌─────────────────────────────────────────────────────────┐     |
|  │                                                         │     |
|  │  ชื่อธุรกิจ *:                                          │     |
|  │  [_________________________________________]             │     |
|  │                                                         │     |
|  │  ประเภทธุรกิจ *:                                        │     |
|  │  [เลือกประเภท▼]                                          │     |
|  │    - โรงแรม                                             │     |
|  │    - ร้านอาหาร                                          │     |
|  │    - ร้านกาแฟ                                           │     |
|  │    - สถานที่ท่องเที่ยว                                  │     |
|  │                                                         │     |
|  │  คำอธิบาย:                                              │     |
|  │  [_________________________________________]             │     |
|  │  [_________________________________________]             │     |
|  │                                                         │     |
|  │  เบอร์โทรศัพท์:                                         │     |
|  │  [_________________________________________]             │     |
|  │                                                         │     |
|  │  อีเมลติดต่อ:                                           │     |
|  │  [_________________________________________]             │     |
|  │                                                         │     |
|  │  เว็บไซต์:                                              │     |
|  │  [_________________________________________]             |     |
|  │                                                         │     |
|  │  [ยกเลิก]              [บันทึก]                          │     |
|  │                                                         │     |
|  └─────────────────────────────────────────────────────────┘     |
+-------------------------------------------------------------------+
```

3. ข้อมูลที่ต้องกรอก:
   - **ชื่อธุรกิจ** (บังคับ): ชื่อของธุรกิจ
   - **ประเภทธุรกิจ** (บังคับ): เลือกจากรายการ
   - **คำอธิบาย**: รายละเอียดของธุรกิจ
   - **เบอร์โทรศัพท์**: หมายเลขโทรศัพท์ติดต่อ (ไม่บังคับ)
   - **อีเมลติดต่อ**: อีเมลของธุรกิจ (ไม่บังคับ)
   - **เว็บไซต์**: URL เว็บไซต์ (ไม่บังคับ)

4. คลิก **"บันทึก"** เพื่อสร้างธุรกิจ

**Path API:** 
- `POST /api/businesses`
- ต้องมี Authorization Header: `Bearer {accessToken}`
- ต้องมี Role: `admin` หรือ `staff`

**ตัวอย่าง Request:**
```json
{
  "name": "โรงแรมบาบาราย",
  "business_type": "โรงแรม",
  "description": "โรงแรมคุณภาพในเมืองศรีสะเกษ",
  "phone_number": "045-123-456",
  "contact_email": "info@babarayhotel.com",
  "website_url": "https://www.babarayhotel.com"
}
```

#### 3.2.2 การแก้ไขธุรกิจ

**ขั้นตอนการแก้ไข:**

1. หาธุรกิจที่ต้องการแก้ไขในตาราง
2. คลิกปุ่ม **"แก้ไข"** (ไอคอน ✏️)
3. แก้ไขข้อมูลในฟอร์ม (เหมือนฟอร์มเพิ่ม)
4. คลิก **"บันทึก"** เพื่ออัปเดตข้อมูล

**Path API:**
- `PUT /api/businesses/{businessId}`
- ต้องมี Authorization Header และ Role ที่เหมาะสม

⚠️ **คำเตือน:**
- การแก้ไขข้อมูลธุรกิจจะทำให้ Embedding เก่าไม่ตรงกับข้อมูลใหม่
- ควรคลิก **"สร้าง Embedding"** หลังจากแก้ไขเสร็จ (ดูหัวข้อ 3.2.5)

#### 3.2.3 การลบธุรกิจ

**ขั้นตอนการลบ:**

1. หาธุรกิจที่ต้องการลบ
2. คลิกปุ่ม **"ลบ"** (ไอคอน 🗑️)
3. ระบบจะแสดงข้อความยืนยัน:

```
+-------------------------------------------------------------------+
|                    ยืนยันการลบ                                    |
|                                                                   |
|  คุณต้องการลบ "ชื่อธุรกิจ" หรือไม่?                                |
|                                                                   |
|  ⚠️ การกระทำนี้ไม่สามารถยกเลิกได้                                  |
|                                                                   |
|           [ยกเลิก]              [ลบ]                              |
+-------------------------------------------------------------------+
```

4. คลิก **"ลบ"** เพื่อยืนยันการลบ

**Path API:**
- `DELETE /api/businesses/{businessId}`
- ต้องมี Authorization Header และ Role ที่เหมาะสม

⚠️ **คำเตือน:**
- การลบธุรกิจจะลบข้อมูลทั้งหมด รวมถึงรูปภาพและ Embedding
- ไม่สามารถกู้คืนข้อมูลที่ถูกลบได้
- รายการธุรกิจที่ถูกลบจะไม่แสดงในระบบ RAG อีกต่อไป

#### 3.2.4 การจัดการรูปภาพธุรกิจ

ดูรายละเอียดในหัวข้อ **7. การจัดการรูปภาพธุรกิจ**

#### 3.2.5 การสร้าง Embedding

**Embedding** คือการแปลงข้อมูลธุรกิจเป็น Vector เพื่อใช้ในการค้นหาแบบ Semantic Search (RAG)

**ขั้นตอนการสร้าง Embedding:**

1. หาธุรกิจที่ต้องการสร้าง Embedding
2. คลิกปุ่ม **"แก้ไข"** เพื่อเปิดหน้าจัดการ
3. คลิกปุ่ม **"สร้าง Embedding"** หรือ **"Enqueue Embedding"**

**Path API:**
- `POST /api/businesses/{businessId}/embedding/enqueue`
- ต้องมี Authorization Header และ Role ที่เหมาะสม

**ตัวอย่าง Response:**
```json
{
  "message": "Embedding job enqueued",
  "id": 123
}
```

**กระบวนการสร้าง Embedding:**

1. ระบบจะส่งข้อมูลธุรกิจไปที่ Embedding Service
2. Embedding Service จะแปลงข้อความเป็น Vector
3. Vector จะถูกบันทึกในฐานข้อมูล (PostgreSQL with pgvector)
4. ใช้เวลาเฉลี่ย 1-2 วินาที ต่อธุรกิจ

⚠️ **คำเตือน:**
- ควรสร้าง Embedding หลังจากเพิ่มหรือแก้ไขข้อมูลธุรกิจ
- ถ้าไม่สร้าง Embedding ระบบจะใช้ Keyword Search แทน Vector Search
- Keyword Search อาจไม่มีประสิทธิภาพเท่า Vector Search

---

## 4. จัดการผู้ใช้

### 4.1 หน้าจัดการผู้ใช้ (Admin เท่านั้น)

```
+-------------------------------------------------------------------+
|  👥 จัดการผู้ใช้                            [+ เพิ่มผู้ใช้]         |
|  ┌─────────────────────────────────────────────────────────┐     |
|  │ อีเมล         │ ชื่อ    │ สิทธิ์  │ สถานะ │ การจัดการ  │     |
|  ├───────────────┼─────────┼────────┼───────┼────────────│     |
|  │ admin@...     │ Admin   │ admin  │ ✅    │ [แก้] [ลบ] │     |
|  │ staff@...     │ Staff   │ staff  │ ✅    │ [แก้] [ลบ] │     |
|  │ sponsor@...   │ Sponsor │ sponsor│ ✅    │ [แก้] [ลบ] │     |
|  └───────────────┴─────────┴────────┴───────┴────────────┘     |
+-------------------------------------------------------------------+
```

⚠️ **หมายเหตุ:** ฟีเจอร์นี้ใช้ได้เฉพาะ **Admin** เท่านั้น Staff ไม่มีสิทธิ์จัดการผู้ใช้

### 4.2 ฟีเจอร์การจัดการผู้ใช้

#### 4.2.1 การเพิ่มผู้ใช้

**ขั้นตอนการเพิ่มผู้ใช้:**

1. คลิกปุ่ม **"+ เพิ่มผู้ใช้"**
2. กรอกข้อมูลในฟอร์ม:

```
+-------------------------------------------------------------------+
|                  เพิ่มผู้ใช้ใหม่                                    |
|  ┌─────────────────────────────────────────────────────────┐     |
|  │                                                         │     |
|  │  อีเมล *:                                               │     |
|  │  [_________________________________________]             │     |
|  │                                                         │     |
|  │  รหัสผ่าน *:                                            │     |
|  │  [_________________________________________]             │     |
|  │                                                         │     |
|  │  ยืนยันรหัสผ่าน *:                                       │     |
|  │  [_________________________________________]             │     |
|  │                                                         │     |
|  │  ชื่อ:                                                  │     |
|  │  [_________________________________________]             │     |
|  │                                                         │     |
|  │  นามสกุล:                                               │     |
|  │  [_________________________________________]             │     |
|  │                                                         │     |
|  │  สิทธิ์ *:                                              │     |
|  │  [เลือกสิทธิ์▼]                                          │     |
|  │    - admin                                              │     |
|  │    - staff                                              │     |
|  │    - sponsor                                            │     |
|  │    - member_pro                                         │     |
|  │    - member                                             │     |
|  │    - guest                                              │     |
|  │                                                         │     |
|  │  [ยกเลิก]              [บันทึก]                          │     |
|  │                                                         │     |
|  └─────────────────────────────────────────────────────────┘     |
+-------------------------------------------------------------------+
```

**Path API:**
- `POST /api/users`
- ต้องมี Authorization Header และ Role: `admin`

**ตัวอย่าง Request:**
```json
{
  "email": "newstaff@example.com",
  "password": "securepassword123",
  "role": "staff",
  "first_name": "John",
  "last_name": "Doe"
}
```

#### 4.2.2 การแก้ไขผู้ใช้

**ขั้นตอนการแก้ไข:**

1. หาผู้ใช้ที่ต้องการแก้ไข
2. คลิกปุ่ม **"แก้ไข"**
3. แก้ไขข้อมูล (อีเมล, ชื่อ, สิทธิ์)
4. คลิก **"บันทึก"**

**Path API:**
- `PUT /api/users/{userId}`

⚠️ **คำเตือน:**
- อย่าแก้ไขสิทธิ์ของผู้ใช้ที่ไม่จำเป็น
- การแก้ไขสิทธิ์อาจส่งผลต่อการเข้าถึงฟีเจอร์ต่างๆ

#### 4.2.3 การระงับ/เปิดใช้งานบัญชี

**ขั้นตอน:**

1. หาผู้ใช้ที่ต้องการระงับ/เปิดใช้งาน
2. คลิกปุ่ม **"แก้ไข"**
3. เปลี่ยนสถานะ **"ระงับ/เปิดใช้งาน"**
4. คลิก **"บันทึก"**

**Path API:**
- `PUT /api/users/{userId}/status`

**ตัวอย่าง Request:**
```json
{
  "is_suspended": true
}
```

⚠️ **คำเตือน:**
- Admin ไม่สามารถระงับบัญชีตัวเองได้
- การระงับบัญชีจะทำให้ผู้ใช้ไม่สามารถเข้าสู่ระบบได้
- ผู้ใช้ที่ถูกระงับจะไม่สามารถใช้งานระบบได้จนกว่าจะเปิดใช้งานใหม่

#### 4.2.4 การลบผู้ใช้

**ขั้นตอน:**

1. หาผู้ใช้ที่ต้องการลบ
2. คลิกปุ่ม **"ลบ"**
3. ยืนยันการลบ

**Path API:**
- `DELETE /api/users/{userId}`

⚠️ **คำเตือน:**
- การลบผู้ใช้จะลบข้อมูลทั้งหมดของผู้ใช้นั้น
- ธุรกิจที่ผูกกับผู้ใช้ที่ถูกลบจะยังคงอยู่ แต่ไม่มีเจ้าของ
- ไม่สามารถกู้คืนข้อมูลผู้ใช้ที่ถูกลบได้

---

## 5. จัดการแพ็กเกจ

### 5.1 หน้าจัดการแพ็กเกจ

```
+-------------------------------------------------------------------+
|  📦 จัดการแพ็กเกจ                          [+ เพิ่มแพ็กเกจ]         |
|  ┌─────────────────────────────────────────────────────────┐     |
|  │ ชื่อแพ็กเกจ  │ ราคา  │ อัตรา/นาที │ สถานะ │ การจัดการ  │     |
|  ├──────────────┼───────┼───────────┼───────┼────────────│     |
|  │ Premium      │ 999฿  │ ไม่จำกัด   │ ✅    │ [แก้] [ลบ] │     |
|  │ Standard     │ 599฿  │ ไม่จำกัด   │ ✅    │ [แก้] [ลบ] │     |
|  │ Free         │ 0฿    │ ไม่จำกัด   │ ✅    │ [แก้] [ลบ] │     |
|  └──────────────┴───────┴───────────┴───────┴────────────┘     |
+-------------------------------------------------------------------+
```

### 5.2 ฟีเจอร์การจัดการแพ็กเกจ

#### 5.2.1 การเพิ่มแพ็กเกจ

**ขั้นตอน:**

1. คลิกปุ่ม **"+ เพิ่มแพ็กเกจ"**
2. กรอกข้อมูลในฟอร์ม:

```
+-------------------------------------------------------------------+
|                  เพิ่มแพ็กเกจใหม่                                   |
|  ┌─────────────────────────────────────────────────────────┐     |
|  │                                                         │     |
|  │  ชื่อแพ็กเกจ *:                                         │     |
|  │  [_________________________________________]             │     |
|  │                                                         │     |
|  │  ราคา (บาท) *:                                          │     |
|  │  [_________________________________________]             │     |
|  │                                                         │     |
|  │  อัตราการใช้งานต่อนาที *:                                 │     |
|  │  [_________________________________________]             │     |
|  │  (หรือเว้นว่างไว้สำหรับไม่จำกัด)                           │     |
|  │                                                         │     |
|  │  คำอธิบาย:                                              │     |
|  │  [_________________________________________]             │     |
|  │                                                         │     |
|  │  [ยกเลิก]              [บันทึก]                          │     |
|  │                                                         │     |
|  └─────────────────────────────────────────────────────────┘     |
+-------------------------------------------------------------------+
```

**Path API:**
- `POST /api/packages`
- ต้องมี Authorization Header และ Role: `admin`

**ตัวอย่าง Request:**
```json
{
  "name": "Premium",
  "price": 999,
  "requests_per_minute": null,
  "description": "แพ็กเกจพรีเมียมสำหรับธุรกิจขนาดใหญ่"
}
```

#### 5.2.2 การแก้ไขแพ็กเกจ

**ขั้นตอน:**

1. หาแพ็กเกจที่ต้องการแก้ไข
2. คลิกปุ่ม **"แก้ไข"**
3. แก้ไขข้อมูล (ชื่อ, ราคา, อัตรา)
4. คลิก **"บันทึก"**

**Path API:**
- `PUT /api/packages/{packageId}`

⚠️ **คำเตือน:**
- การแก้ไขแพ็กเกจจะส่งผลต่อผู้ใช้ที่ใช้แพ็กเกจนั้น
- ควรแจ้งผู้ใช้ล่วงหน้าก่อนแก้ไขแพ็กเกจ

#### 5.2.3 การลบแพ็กเกจ

**ขั้นตอน:**

1. หาแพ็กเกจที่ต้องการลบ
2. คลิกปุ่ม **"ลบ"**
3. ยืนยันการลบ

**Path API:**
- `DELETE /api/packages/{packageId}`

⚠️ **คำเตือน:**
- ไม่สามารถลบแพ็กเกจที่มีผู้ใช้ใช้งานอยู่ได้
- ต้องย้ายผู้ใช้ทั้งหมดไปแพ็กเกจอื่นก่อนลบ

---

## 6. สลิปการชำระเงิน

### 6.1 หน้าสลิปการชำระเงิน

```
+-------------------------------------------------------------------+
|  💰 สลิปการชำระเงิน          [ทั้งหมด▼] [รอตรวจสอบ] [อนุมัติ] [ปฏิเสธ]│
|  ┌─────────────────────────────────────────────────────────┐     |
|  │ รหัส │ ธุรกิจ │ แพ็กเกจ │ จำนวน │ วันที่ │ สถานะ │ จัดการ │     |
|  ├──────┼────────┼─────────┼───────┼───────┼───────┼───────│     |
|  │ #1a  │ บาบาราย│ Premium │ 999฿ │ 1 ม.ค. │ ⏳รอ   │ [ดู][✓][✗] │     |
|  │ #1b  │ Better │Standard │ 599฿ │ 2 ม.ค. │ ✅อนุมัติ│ [ดู]      │     |
|  │ #1c  │ Sweet  │ Free    │ 0฿   │ 3 ม.ค. │ ❌ปฏิเสธ│ [ดู]      │     |
|  └──────┴────────┴─────────┴───────┴───────┴───────┴───────┘     |
+-------------------------------------------------------------------+
```

### 6.2 ฟีเจอร์การจัดการสลิป

#### 6.2.1 การดูสลิป

**ขั้นตอน:**

1. หาสลิปที่ต้องการดู
2. คลิกปุ่ม **"View"** (ไอคอน 🖼️)
3. ระบบจะแสดงภาพสลิป:

```
+-------------------------------------------------------------------+
|                    ภาพสลิปการชำระเงิน                              |
|  ┌─────────────────────────────────────────────────────────┐     |
|  │                                                         │     |
|  │                  [ภาพสลิปขนาดใหญ่]                        │     |
|  │                                                         │     |
|  │  รหัสสลิป: #1a2b3c4d                                    │     |
|  │  ธุรกิจ: บาบาราย โฮเทล                                   │     |
|  │  แพ็กเกจ: Premium                                        │     |
|  │  จำนวนเงิน: 999 บาท                                      │     |
|  │  วันที่: 1 มกราคม 2568                                    │     |
|  │                                                         │     |
|  │              [ปิด]                                      │     |
|  │                                                         │     |
|  └─────────────────────────────────────────────────────────┘     |
+-------------------------------------------------------------------+
```

**Path API:**
- `GET /api/payment-slips/{slipId}`
- Path รูปภาพ: `/uploads/payment-slips/{filename}`

#### 6.2.2 การอนุมัติสลิป

**ขั้นตอน:**

1. หาสลิปที่มีสถานะ **"รอการตรวจสอบ"** (⏳)
2. คลิกปุ่ม **"Approve"** (ไอคอน ✓)
3. ระบบจะแสดงข้อความยืนยัน:

```
+-------------------------------------------------------------------+
|                    ยืนยันการอนุมัติ                                |
|                                                                   |
|  คุณต้องการอนุมัติสลิป #1a2b3c4d หรือไม่?                         |
|                                                                   |
|  ธุรกิจ: บาบาราย โฮเทล                                            |
|  แพ็กเกจ: Premium                                                |
|  จำนวนเงิน: 999 บาท                                               |
|                                                                   |
|           [ยกเลิก]              [อนุมัติ]                          |
+-------------------------------------------------------------------+
```

4. คลิก **"อนุมัติ"** เพื่อยืนยัน

**Path API:**
- `POST /api/payment-slips/{slipId}/approve`
- ต้องมี Authorization Header และ Role: `staff` หรือ `admin`

**ผลลัพธ์:**
- สถานะสลิปจะเปลี่ยนเป็น **"อนุมัติแล้ว"** (✅)
- ธุรกิจจะได้รับแพ็กเกจตามที่ชำระเงิน
- ระบบจะสร้างหรืออัปเดต Business Package ให้อัตโนมัติ

#### 6.2.3 การปฏิเสธสลิป

**ขั้นตอน:**

1. หาสลิปที่มีสถานะ **"รอการตรวจสอบ"**
2. คลิกปุ่ม **"Reject"** (ไอคอน ✗)
3. กรอกเหตุผลการปฏิเสธ (ถ้ามี):

```
+-------------------------------------------------------------------+
|                    ปฏิเสธสลิป                                     |
|                                                                   |
|  คุณต้องการปฏิเสธสลิป #1a2b3c4d หรือไม่?                         |
|                                                                   |
|  เหตุผลการปฏิเสธ (ไม่บังคับ):                                      |
|  [_________________________________________]                     |
|  [_________________________________________]                     |
|                                                                   |
|           [ยกเลิก]              [ปฏิเสธ]                          |
+-------------------------------------------------------------------+
```

4. คลิก **"ปฏิเสธ"** เพื่อยืนยัน

**Path API:**
- `POST /api/payment-slips/{slipId}/reject`
- ต้องมี Authorization Header และ Role: `staff` หรือ `admin`

**ผลลัพธ์:**
- สถานะสลิปจะเปลี่ยนเป็น **"ปฏิเสธ"** (❌)
- ธุรกิจจะได้รับการแจ้งเตือน (ถ้ามีระบบแจ้งเตือน)
- ธุรกิจสามารถอัปโหลดสลิปใหม่ได้

#### 6.2.4 การกรองสลิป

**ขั้นตอน:**

1. คลิกที่ dropdown **"ทั้งหมด"** ที่มุมขวาบน
2. เลือกสถานะที่ต้องการ:
   - **ทั้งหมด**: แสดงทุกสลิป
   - **รอการตรวจสอบ**: แสดงเฉพาะสลิปที่รออนุมัติ
   - **อนุมัติแล้ว**: แสดงเฉพาะสลิปที่อนุมัติแล้ว
   - **ปฏิเสธ**: แสดงเฉพาะสลิปที่ปฏิเสธ

**Path API:**
- `GET /api/payment-slips?status={status}`

⚠️ **คำเตือน:**
- ควรตรวจสอบสลิปอย่างละเอียดก่อนอนุมัติ
- ตรวจสอบว่า:
  - จำนวนเงินตรงกับแพ็กเกจที่เลือก
  - วันที่และเวลาการโอนถูกต้อง
  - ข้อมูลธุรกิจถูกต้อง
  - ภาพสลิปชัดเจนและอ่านได้

---

## 7. การจัดการรูปภาพธุรกิจ

### 7.1 หน้าจัดการรูปภาพ

```
+-------------------------------------------------------------------+
|          รูปภาพธุรกิจ: บาบาราย โฮเทล                               |
|  ┌─────────────────────────────────────────────────────────┐     |
|  │                                                         │     |
|  │  📸 รูปภาพทั้งหมด (5 รูป)                                │     |
|  │                                                         │     |
|  │  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐            │     |
|  │  │ ⭐  │ │     │ │     │ │     │ │     │            │     |
|  │  │ [ภาพ│ │ [ภาพ│ │ [ภาพ│ │ [ภาพ│ │ [ภาพ│            │     |
|  │  │  1] │ │  2] │ │  3] │ │  4] │ │  5] │            │     |
|  │  └─────┘ └─────┘ └─────┘ └─────┘ └─────┘            │     |
|  │    ⭐=ปก                                               │     |
|  │                                                         │     |
|  │  [+ เพิ่มรูปภาพ]                                        │     |
|  │                                                         │     |
|  └─────────────────────────────────────────────────────────┘     |
+-------------------------------------------------------------------+
```

### 7.2 ฟีเจอร์การจัดการรูปภาพ

#### 7.2.1 การเพิ่มรูปภาพ

**ขั้นตอน:**

1. ไปที่หน้าจัดการธุรกิจ
2. คลิกปุ่ม **"รูปภาพ"** ของธุรกิจที่ต้องการ
3. คลิกปุ่ม **"+ เพิ่มรูปภาพ"**
4. เลือกไฟล์รูปภาพจากเครื่อง:

```
+-------------------------------------------------------------------+
|                    เลือกรูปภาพ                                     |
|  ┌─────────────────────────────────────────────────────────┐     |
|  │                                                         │     |
|  │  [เลือกไฟล์]                                            │     |
|  │                                                         │     |
|  │  รูปแบบที่รองรับ: JPG, PNG, GIF, WebP                   │     |
|  │  ขนาดสูงสุด: 10 MB                                      │     |
|  │                                                         │     |
|  │  คำอธิบาย (ไม่บังคับ):                                   │     |
|  │  [_________________________________________]             │     |
|  │                                                         │     |
|  │  [ยกเลิก]              [อัปโหลด]                        │     |
|  │                                                         │     |
|  └─────────────────────────────────────────────────────────┘     |
+-------------------------------------------------------------------+
```

5. คลิก **"อัปโหลด"**

**Path API:**
- `POST /api/businesses/{businessId}/images`
- Method: `multipart/form-data`
- Fields:
  - `image`: ไฟล์รูปภาพ
  - `caption`: คำอธิบาย (ไม่บังคับ)

**ข้อกำหนดไฟล์:**
- รูปแบบ: JPG, PNG, GIF, WebP
- ขนาดสูงสุด: 10 MB
- ขนาดที่แนะนำ: 1920x1080 pixels หรือสูงกว่า

#### 7.2.2 การตั้งรูปปก

**ขั้นตอน:**

1. ไปที่หน้าจัดการรูปภาพธุรกิจ
2. หารูปที่ต้องการตั้งเป็นปก
3. คลิกปุ่ม **"ตั้งเป็นปก"** (ไอคอน ⭐)

**Path API:**
- `PUT /api/businesses/images/{imageId}/cover`

**ผลลัพธ์:**
- รูปที่เลือกจะถูกตั้งเป็นรูปปก
- รูปปกจะแสดงก่อนรูปอื่นๆ
- รูปปกเดิมจะถูกยกเลิกอัตโนมัติ

#### 7.2.3 การลบรูปภาพ

**ขั้นตอน:**

1. ไปที่หน้าจัดการรูปภาพธุรกิจ
2. หารูปที่ต้องการลบ
3. คลิกปุ่ม **"ลบ"** (ไอคอน 🗑️)
4. ยืนยันการลบ

**Path API:**
- `DELETE /api/businesses/images/{imageId}`

⚠️ **คำเตือน:**
- ไม่สามารถกู้คืนรูปภาพที่ถูกลบได้
- ควรสำรองรูปภาพสำคัญไว้ก่อนลบ
- รูปปกที่ถูกลบจะต้องตั้งรูปปกใหม่

---

## 8. การสร้าง Embedding

### 8.1 ความสำคัญของ Embedding

**Embedding** เป็นการแปลงข้อมูลธุรกิจเป็น Vector เพื่อใช้ในการค้นหาแบบ Semantic Search (RAG)

**ประโยชน์:**
- ค้นหาธุรกิจตามความหมาย ไม่ใช่แค่คำตรง
- ผลลัพธ์มีความเกี่ยวข้องมากขึ้น
- รองรับการค้นหาแบบหลายภาษา

### 8.2 ขั้นตอนการสร้าง Embedding

ดูรายละเอียดใน **หัวข้อ 3.2.5 การสร้าง Embedding**

### 8.3 การสร้าง Embedding หลายรายการพร้อมกัน

**ด้วย API:**

```bash
# สร้าง Embedding สำหรับธุรกิจทั้งหมด
curl -X POST "http://localhost:3000/api/businesses/{businessId}/embedding/enqueue" \
  -H "Authorization: Bearer {accessToken}"
```

**ด้วย Script:**

ดูใน `/home/vit/HowtoUse.md` สำหรับคำสั่งต่างๆ

### 8.4 การตรวจสอบสถานะ Embedding

**ด้วย API:**

```bash
# ดูข้อมูลธุรกิจพร้อม Embedding
curl "http://localhost:3000/api/businesses/{businessId}" \
  -H "Authorization: Bearer {accessToken}"
```

**Response:**
```json
{
  "id": 123,
  "name": "โรงแรมบาบาราย",
  "embedding": "[0.123, -0.456, ...]"  // มี embedding
}
```

หรือ

```json
{
  "id": 123,
  "name": "โรงแรมบาบาราย",
  "embedding": null  // ยังไม่มี embedding
}
```

⚠️ **คำเตือน:**
- Embedding ที่สร้างใหม่จะแทนที่ Embedding เก่า
- ควรสร้าง Embedding หลังจากเพิ่มหรือแก้ไขข้อมูลเสร็จแล้ว
- หากไม่สร้าง Embedding ระบบจะใช้ Keyword Search ซึ่งอาจไม่มีประสิทธิภาพเท่า

---

## 9. การจัดการ Transaction

### 9.1 หน้าที่ใช้ดู Transaction

Transaction คือประวัติการชำระเงินและการอัปเดตแพ็กเกจ

**Path API:**
- `GET /api/transactions` (สำหรับ Staff/Admin)
- `GET /api/transactions?status={status}` (กรองตามสถานะ)

**ตัวอย่าง Response:**
```json
{
  "data": [
    {
      "id": 1,
      "business_package_id": 5,
      "amount": 999,
      "status": "completed",
      "created_at": "2025-01-01T10:00:00Z"
    }
  ]
}
```

### 9.2 การอัปเดตสถานะ Transaction

**Path API:**
- `PUT /api/transactions/{transactionId}/status`

**ตัวอย่าง Request:**
```json
{
  "status": "completed"
}
```

**สถานะที่มี:**
- `pending`: รอการชำระเงิน
- `processing`: กำลังประมวลผล
- `completed`: เสร็จสมบูรณ์
- `failed`: ล้มเหลว
- `cancelled`: ยกเลิก

---

## 10. คำสั่งและ Path ที่เกี่ยวข้อง

### 10.1 API Endpoints สำหรับ Staff/Admin

#### 10.1.1 ธุรกิจ (Businesses)

```
GET    /api/businesses                    - ดึงรายการธุรกิจทั้งหมด
GET    /api/businesses/:id                - ดึงข้อมูลธุรกิจตาม ID
POST   /api/businesses                    - สร้างธุรกิจใหม่ (Staff/Admin)
PUT    /api/businesses/:id                - แก้ไขธุรกิจ (Staff/Admin)
DELETE /api/businesses/:id                - ลบธุรกิจ (Staff/Admin)
POST   /api/businesses/:id/embedding/enqueue - สร้าง Embedding (Staff/Admin)
```

#### 10.1.2 รูปภาพธุรกิจ

```
GET    /api/businesses/:id/images         - ดึงรายการรูปภาพ
POST   /api/businesses/:id/images         - เพิ่มรูปภาพ (Staff/Admin)
DELETE /api/businesses/images/:imageId    - ลบรูปภาพ (Staff/Admin)
PUT    /api/businesses/images/:imageId/cover - ตั้งรูปปก (Staff/Admin)
```

#### 10.1.3 ผู้ใช้ (Users) - Admin เท่านั้น

```
GET    /api/users                         - ดึงรายการผู้ใช้ทั้งหมด (Admin)
GET    /api/users/:userId                 - ดึงข้อมูลผู้ใช้ (Admin)
POST   /api/users                         - สร้างผู้ใช้ใหม่ (Admin)
PUT    /api/users/:userId                 - แก้ไขผู้ใช้ (Admin)
PUT    /api/users/:userId/status          - ระงับ/เปิดใช้งาน (Admin)
DELETE /api/users/:userId                 - ลบผู้ใช้ (Admin)
```

#### 10.1.4 แพ็กเกจ (Packages) - Admin เท่านั้น

```
GET    /api/packages                      - ดึงรายการแพ็กเกจทั้งหมด
GET    /api/packages/:id                  - ดึงข้อมูลแพ็กเกจ
POST   /api/packages                      - สร้างแพ็กเกจใหม่ (Admin)
PUT    /api/packages/:id                  - แก้ไขแพ็กเกจ (Admin)
DELETE /api/packages/:id                  - ลบแพ็กเกจ (Admin)
```

#### 10.1.5 สลิปการชำระเงิน (Payment Slips)

```
GET    /api/payment-slips                 - ดึงรายการสลิป (Staff/Admin/Sponsor)
GET    /api/payment-slips/:id             - ดึงข้อมูลสลิป (Staff/Admin)
POST   /api/payment-slips/:id/approve     - อนุมัติสลิป (Staff/Admin)
POST   /api/payment-slips/:id/reject      - ปฏิเสธสลิป (Staff/Admin)
```

#### 10.1.6 Transaction

```
GET    /api/transactions                  - ดึงรายการ Transaction (Staff/Admin)
PUT    /api/transactions/:id/status       - อัปเดตสถานะ (Staff/Admin)
```

### 10.2 Path ไฟล์ที่เกี่ยวข้อง

**Frontend:**
- `/home/vit/llm-chat-frontend/src/templates/admin.html` - หน้า Admin Panel
- `/home/vit/llm-chat-frontend/src/js/staff.js` - ไฟล์ JavaScript สำหรับ Staff Panel
- `/home/vit/llm-chat-frontend/src/js/api.js` - ไฟล์ API Client

**Backend:**
- `/home/vit/llm-chat-backend/src/routes/business.routes.js` - Routes สำหรับธุรกิจ
- `/home/vit/llm-chat-backend/src/routes/user.routes.js` - Routes สำหรับผู้ใช้
- `/home/vit/llm-chat-backend/src/routes/package.routes.js` - Routes สำหรับแพ็กเกจ
- `/home/vit/llm-chat-backend/src/routes/payment-slip.routes.js` - Routes สำหรับสลิป
- `/home/vit/llm-chat-backend/src/controllers/business.controller.js` - Controller สำหรับธุรกิจ

**ฐานข้อมูล:**
- Database: `llmchat_db`
- Tables:
  - `businesses` - ข้อมูลธุรกิจ
  - `users` - ข้อมูลผู้ใช้
  - `packages` - ข้อมูลแพ็กเกจ
  - `business_packages` - ความสัมพันธ์ธุรกิจ-แพ็กเกจ
  - `payment_slips` - สลิปการชำระเงิน
  - `business_images` - รูปภาพธุรกิจ
  - `transactions` - ประวัติการทำธุรกรรม

### 10.3 คำสั่ง Docker ที่เกี่ยวข้อง

```bash
# ดู Logs ของ API
docker logs vit-llm-chat-api-1 -f

# ดู Logs ของ Database
docker logs vit-llm-chat-database-1 -f

# เข้าไปใน Container API
docker exec -it vit-llm-chat-api-1 bash

# เข้าไปใน Container Database
docker exec -it vit-llm-chat-database-1 psql -U postgres -d llmchat_db

# Restart API Service
docker restart vit-llm-chat-api-1
```

### 10.4 คำสั่ง SQL ที่เกี่ยวข้อง

```sql
-- ดูธุรกิจทั้งหมด
SELECT id, name, business_type, is_active FROM businesses;

-- ดูผู้ใช้ทั้งหมด
SELECT id, email, role, is_suspended FROM users;

-- ดูสลิปที่รอการตรวจสอบ
SELECT id, business_id, status, amount FROM payment_slips WHERE status = 'pending';

-- ดูธุรกิจที่ไม่มี Embedding
SELECT id, name FROM businesses WHERE embedding IS NULL;
```

---

## 11. คำเตือนและข้อควรระวัง

### 11.1 การจัดการข้อมูล

⚠️ **คำเตือนทั่วไป:**
1. **สำรองข้อมูลก่อนแก้ไขสำคัญ**: ควรสำรองข้อมูลหรือรูปภาพที่สำคัญก่อนลบหรือแก้ไข
2. **ตรวจสอบข้อมูลก่อนบันทึก**: ควรตรวจสอบข้อมูลให้ถูกต้องก่อนบันทึกทุกครั้ง
3. **บันทึกการเปลี่ยนแปลง**: จดบันทึกการเปลี่ยนแปลงที่ทำไปเพื่ออ้างอิงในอนาคต

### 11.2 การจัดการผู้ใช้

⚠️ **คำเตือน:**
1. **อย่าลบ Admin หลัก**: อย่าลบบัญชี Admin หลักที่ใช้เข้าสู่ระบบ
2. **ตรวจสอบสิทธิ์ก่อนให้**: ตรวจสอบให้แน่ใจว่าสิทธิ์ที่ให้เหมาะสมกับงาน
3. **ระงับแทนการลบ**: ถ้าไม่แน่ใจควรระงับบัญชีแทนการลบ

### 11.3 การจัดการสลิปการชำระเงิน

⚠️ **คำเตือน:**
1. **ตรวจสอบสลิปอย่างละเอียด**: 
   - จำนวนเงินต้องตรงกับแพ็กเกจ
   - วันที่และเวลาต้องถูกต้อง
   - ข้อมูลธุรกิจต้องตรงกับสลิป
2. **อนุมัติด้วยความระมัดระวัง**: การอนุมัติจะทำให้ธุรกิจได้รับแพ็กเกจทันที
3. **บันทึกเหตุผลการปฏิเสธ**: ควรบันทึกเหตุผลให้ชัดเจนเพื่ออ้างอิง

### 11.4 การจัดการ Embedding

⚠️ **คำเตือน:**
1. **สร้าง Embedding หลังจากแก้ไข**: ควรสร้าง Embedding ใหม่หลังจากแก้ไขข้อมูลธุรกิจ
2. **ตรวจสอบก่อนสร้าง**: ตรวจสอบว่าข้อมูลถูกต้องก่อนสร้าง Embedding
3. **Embedding ใช้เวลา**: การสร้าง Embedding ใช้เวลา 1-2 วินาทีต่อรายการ

### 11.5 ความปลอดภัย

⚠️ **คำเตือน:**
1. **ออกจากระบบเมื่อเสร็จ**: ออกจากระบบทุกครั้งเมื่อเสร็จสิ้นการทำงาน
2. **ไม่แชร์ข้อมูลการเข้าสู่ระบบ**: อย่าแชร์อีเมลและรหัสผ่านกับผู้อื่น
3. **ใช้รหัสผ่านที่แข็งแรง**: ควรเปลี่ยนรหัสผ่านเป็นระยะๆ

### 11.6 ปัญหาที่พบบ่อยและวิธีแก้ไข

#### ปัญหา: ไม่สามารถเข้าสู่ระบบได้
**วิธีแก้ไข:**
1. ตรวจสอบอีเมลและรหัสผ่าน
2. ตรวจสอบว่าบัญชีถูกระงับหรือไม่
3. ล้าง Cache และ Cookies ของเบราว์เซอร์
4. ติดต่อผู้ดูแลระบบหลัก

#### ปัญหา: ไม่สามารถเพิ่มธุรกิจได้
**วิธีแก้ไข:**
1. ตรวจสอบว่ามีสิทธิ์ Staff หรือ Admin
2. ตรวจสอบว่าข้อมูลกรอกครบถ้วน
3. ตรวจสอบว่าไม่มีธุรกิจชื่อเดียวกันอยู่แล้ว
4. ตรวจสอบ Logs: `docker logs vit-llm-chat-api-1`

#### ปัญหา: รูปภาพไม่แสดง
**วิธีแก้ไข:**
1. ตรวจสอบรูปแบบไฟล์ (ต้องเป็น JPG, PNG, GIF, WebP)
2. ตรวจสอบขนาดไฟล์ (ไม่เกิน 10 MB)
3. ตรวจสอบ Path ของไฟล์: `/uploads/business-images/`
4. ตรวจสอบ Permission ของโฟลเดอร์

#### ปัญหา: Embedding ไม่ทำงาน
**วิธีแก้ไข:**
1. ตรวจสอบว่า Embedding Service ทำงานอยู่: `docker ps | grep embedder`
2. ตรวจสอบ Logs: `docker logs vit-llm-chat-embedder-1`
3. สร้าง Embedding ใหม่: ใช้ API endpoint `/embedding/enqueue`

---

## 12. ติดต่อและความช่วยเหลือ

### 12.1 ติดต่อผู้ดูแลระบบ

- **อีเมล**: admin@example.com
- **เบอร์โทรศัพท์**: [ข้อมูลติดต่อ]

### 12.2 คำถามที่พบบ่อย (FAQ)

**Q: ฉันสามารถแก้ไขข้อมูลธุรกิจของ Sponsor ได้หรือไม่?**
A: ได้ Staff และ Admin สามารถแก้ไขข้อมูลธุรกิจทั้งหมดได้

**Q: ฉันลบผู้ใช้ผิด จะกู้คืนได้หรือไม่?**
A: ไม่ได้ การลบผู้ใช้ไม่สามารถกู้คืนได้ ควรระมัดระวังในการลบ

**Q: สลิปที่อนุมัติไปแล้วสามารถยกเลิกได้หรือไม่?**
A: ไม่สามารถยกเลิกได้โดยตรง ควรติดต่อผู้ดูแลระบบหลัก

**Q: ต้องสร้าง Embedding ทุกครั้งที่แก้ไขข้อมูลหรือไม่?**
A: แนะนำให้สร้าง เพราะ Embedding เก่าอาจไม่ตรงกับข้อมูลใหม่

---

## สรุป

คู่มือนี้ครอบคลุมการใช้งานระบบ SRI-KETGUIDE สำหรับผู้ช่วยผู้ดูแลระบบ (Staff/Admin) ซึ่งรวมถึงการจัดการธุรกิจ ผู้ใช้ แพ็กเกจ สลิปการชำระเงิน และรูปภาพ

หากมีคำถามหรือต้องการความช่วยเหลือเพิ่มเติม กรุณาติดต่อผู้ดูแลระบบหลัก

---

**อัปเดตล่าสุด:** ตุลาคม 2568  
**เวอร์ชัน:** 1.0  
**URL:** https://frontend.sri-ketguide.com

