# คู่มือการใช้งานระบบ SRI-KETGUIDE สำหรับผู้ดูแลระบบ (Admin)

**บัญชีผู้ใช้:** `admin@example.com`  
**รหัสผ่าน:** `1234`  
**URL:** `https://frontend.sri-ketguide.com/#/admin`

⚠️ **หมายเหตุ:** คู่มือนี้สำหรับ **Admin เท่านั้น** Admin มีสิทธิ์เต็มที่ในการจัดการระบบทั้งหมด รวมถึงฟีเจอร์ทั้งหมดที่ Staff มี และสามารถจัดการผู้ใช้ แพ็กเกจ และการตั้งค่าระบบได้

---

## สารบัญ
1. [การเข้าสู่ระบบ](#1-การเข้าสู่ระบบ)
2. [หน้าหลัก Admin Panel](#2-หน้าหลัก-admin-panel)
3. [จัดการผู้ใช้ (Admin เท่านั้น)](#3-จัดการผู้ใช้-admin-เท่านั้น)
4. [จัดการแพ็กเกจ (Admin เท่านั้น)](#4-จัดการแพ็กเกจ-admin-เท่านั้น)
5. [จัดการธุรกิจ](#5-จัดการธุรกิจ)
6. [สลิปการชำระเงิน](#6-สลิปการชำระเงิน)
7. [การจัดการรูปภาพธุรกิจ](#7-การจัดการรูปภาพธุรกิจ)
8. [การตั้งค่าระบบ](#8-การตั้งค่าระบบ)
9. [การสร้าง Embedding](#9-การสร้าง-embedding)
10. [การสำรองและกู้คืนข้อมูล](#10-การสำรองและกู้คืนข้อมูล)
11. [การจัดการ Transaction](#11-การจัดการ-transaction)
12. [คำสั่งและ Path ที่เกี่ยวข้อง](#12-คำสั่งและ-path-ที่เกี่ยวข้อง)
13. [คำเตือนและข้อควรระวังสำหรับ Admin](#13-คำเตือนและข้อควรระวังสำหรับ-admin)

---

## 1. การเข้าสู่ระบบ

### 1.1 หน้าล็อกอิน

```
+-------------------------------------------------------------------+
|                                                                   |
|                     SRI-KETGUIDE                                  |
|           ระบบประชาสัมพันธ์การท่องเที่ยวอัจฉริยะ                    |
|                                                                   |
|  +----------------------------------------------------------+     |
|  |                                                          |     |
|  |   อีเมล: [____________________________]                   |     |
|  |                                                          |     |
|  |   รหัสผ่าน: [____________________________]                |     |
|  |                                                          |     |
|  |              [  เข้าสู่ระบบ  ]                             |     |
|  |                                                          |     |
|  |   [ ] จดจำการเข้าสู่ระบบ                                   |     |
|  |                                                          |     |
|  +----------------------------------------------------------+     |
|                                                                   |
|  URL: https://frontend.sri-ketguide.com/#/login                |
|                                                                   |
+-------------------------------------------------------------------+
```

### 1.2 ข้อมูลเข้าสู่ระบบสำหรับ Admin

- **อีเมล:** `admin@example.com`
- **รหัสผ่าน:** `1234`
- **สิทธิ์:** `admin` (สิทธิ์เต็มที่)

⚠️ **คำเตือนความปลอดภัยสำหรับ Admin:**
- ⚠️ **ห้ามแชร์ข้อมูลการเข้าสู่ระบบกับใคร**
- ⚠️ **ใช้รหัสผ่านที่แข็งแรงและเปลี่ยนเป็นระยะ**
- ⚠️ **ออกจากระบบทุกครั้งเมื่อเสร็จสิ้นการทำงาน**
- ⚠️ **อย่าจดจำรหัสผ่านบนคอมพิวเตอร์สาธารณะ**
- ⚠️ **ตรวจสอบ Log การเข้าสู่ระบบเป็นประจำ**

---

## 2. หน้าหลัก Admin Panel

### 2.1 ภาพหน้าจอ Admin Panel

```
+-------------------------------------------------------------------+
|  ┌───────────────────────────────────────────────────────────┐  |
|  │  SRI-KETGUIDE           [Chat] [Staff] [Sponsor] [Admin]  │  |
|  └───────────────────────────────────────────────────────────┘  |
|                                                                   |
|  ┌───────────────────────────────────────────────────────────┐  |
|  │  📋 แท็บการจัดการ:                                         │  |
|  │  ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌────────┐ │  |
|  │  │ 🏪 จัดการ   │ │ 👥 จัดการ   │ │ 📦 จัดการ   │ │ 💰 สลิป│ │  |
|  │  │ ธุรกิจ (40)│ │ ผู้ใช้ (15) │ │ แพ็กเกจ (3)│ │ (12)   │ │  |
|  │  └────────────┘ └────────────┘ └────────────┘ └────────┘ │  |
|  └───────────────────────────────────────────────────────────┘  |
|                                                                   |
|  ┌───────────────────────────────────────────────────────────┐  |
|  │  🛡️  Admin Panel                                          │  |
|  │     จัดการระบบทั้งหมด                                     │  |
|  └───────────────────────────────────────────────────────────┘  |
|                                                                   |
+-------------------------------------------------------------------+
```

### 2.2 ความแตกต่างระหว่าง Admin และ Staff

**Admin มีสิทธิ์พิเศษเพิ่มเติม:**

✅ **จัดการผู้ใช้** - สร้าง/แก้ไข/ลบ/ระงับผู้ใช้ได้ทั้งหมด  
✅ **จัดการแพ็กเกจ** - สร้าง/แก้ไข/ลบแพ็กเกจได้  
✅ **จัดการระบบทั้งหมด** - เข้าถึงทุกฟีเจอร์  
✅ **ดู Logs และ Statistics** - ตรวจสอบการใช้งานระบบ  
✅ **ตั้งค่าระบบ** - ปรับแต่งการตั้งค่าระบบ  

**Staff ทำได้:**
✅ จัดการธุรกิจ  
✅ จัดการสลิปการชำระเงิน  
❌ จัดการผู้ใช้ (ไม่มีสิทธิ์)  
❌ จัดการแพ็กเกจ (ไม่มีสิทธิ์)  

---

## 3. จัดการผู้ใช้ (Admin เท่านั้น)

### 3.1 หน้าจัดการผู้ใช้

```
+-------------------------------------------------------------------+
|  👥 จัดการผู้ใช้                            [+ เพิ่มผู้ใช้]         |
|  ┌─────────────────────────────────────────────────────────┐     |
|  │ อีเมล         │ ชื่อ    │ สิทธิ์  │ สถานะ │ การจัดการ  │     |
|  ├───────────────┼─────────┼────────┼───────┼────────────│     |
|  │ admin@...     │ Admin   │ admin  │ ✅    │ [แก้] [ลบ] │     |
|  │ staff@...     │ Staff   │ staff  │ ✅    │ [แก้] [ลบ] │     |
|  │ sponsor@...   │ Sponsor │ sponsor│ ✅    │ [แก้] [ลบ] │     |
|  │ member@...    │ Member  │ member │ ✅    │ [แก้] [ลบ] │     |
|  │ guest@...     │ Guest   │ guest  │ ✅    │ [แก้] [ลบ] │     |
|  └───────────────┴─────────┴────────┴───────┴────────────┘     |
+-------------------------------------------------------------------+
```

### 3.2 ฟีเจอร์การจัดการผู้ใช้

#### 3.2.1 การเพิ่มผู้ใช้

**ขั้นตอน:**

1. คลิกปุ่ม **"+ เพิ่มผู้ใช้"**
2. กรอกข้อมูลในฟอร์ม:

```
+-------------------------------------------------------------------+
|                  เพิ่มผู้ใช้ใหม่                                    |
|  ┌─────────────────────────────────────────────────────────┐     |
|  │                                                         │     |
|  │  อีเมล *:                                               │     |
|  │  [_________________________________________]             │     |
|  │                                                         │     |
|  │  รหัสผ่าน *:                                            │     |
|  │  [_________________________________________]             │     |
|  │  (ขั้นต่ำ 6 ตัวอักษร)                                     │     |
|  │                                                         │     |
|  │  ยืนยันรหัสผ่าน *:                                       │     |
|  │  [_________________________________________]             │     |
|  │                                                         │     |
|  │  ชื่อ (First Name):                                     │     |
|  │  [_________________________________________]             │     |
|  │                                                         │     |
|  │  นามสกุล (Last Name):                                   │     |
|  │  [_________________________________________]             │     |
|  │                                                         │     |
|  │  สิทธิ์ *:                                              │     |
|  │  [เลือกสิทธิ์▼]                                          │     |
|  │    - admin                                              │     |
|  │    - staff                                              │     |
|  │    - sponsor                                            │     |
|  │    - member_pro                                         │     |
|  │    - member                                             │     |
|  │    - guest                                              │     |
|  │                                                         │     |
|  │  [ยกเลิก]              [บันทึก]                          │     |
|  │                                                         │     |
|  └─────────────────────────────────────────────────────────┘     |
+-------------------------------------------------------------------+
```

**Path API:**
- `POST /api/users`
- ต้องมี Authorization Header และ Role: `admin` เท่านั้น

**ตัวอย่าง Request:**
```json
{
  "email": "newuser@example.com",
  "password": "securepassword123",
  "role": "member",
  "first_name": "John",
  "last_name": "Doe"
}
```

⚠️ **คำเตือน:**
- ตรวจสอบให้แน่ใจว่าอีเมลไม่ซ้ำ
- ใช้รหัสผ่านที่แข็งแรง (ขั้นต่ำ 6 ตัวอักษร)
- เลือกสิทธิ์ที่เหมาะสมกับงานของผู้ใช้

#### 3.2.2 การแก้ไขผู้ใช้

**ขั้นตอน:**

1. หาผู้ใช้ที่ต้องการแก้ไข
2. คลิกปุ่ม **"แก้ไข"** (ไอคอน ✏️)
3. แก้ไขข้อมูล:

**ข้อมูลที่แก้ไขได้:**
- อีเมล
- รหัสผ่าน (ถ้าต้องการเปลี่ยน)
- ชื่อ-นามสกุล
- สิทธิ์ (Role)
- สถานะ (ระงับ/เปิดใช้งาน)

**Path API:**
- `PUT /api/users/{userId}`

⚠️ **คำเตือนสำคัญ:**
- ⚠️ **อย่าเปลี่ยนสิทธิ์ของผู้ใช้โดยไม่จำเป็น**
- ⚠️ **การเปลี่ยนเป็น Admin ต้องระมัดระวังมาก**
- ⚠️ **ตรวจสอบความต้องการก่อนเปลี่ยนสิทธิ์**
- ⚠️ **Admin หลักไม่ควรถูกลบหรือระงับ**

#### 3.2.3 การระงับ/เปิดใช้งานบัญชี

**ขั้นตอน:**

1. หาผู้ใช้ที่ต้องการระงับ/เปิดใช้งาน
2. คลิกปุ่ม **"แก้ไข"**
3. เปลี่ยนสถานะ **"ระงับ/เปิดใช้งาน"**:

```
+-------------------------------------------------------------------+
|              แก้ไขผู้ใช้                                           |
|  ┌─────────────────────────────────────────────────────────┐     |
|  │                                                         │     |
|  │  อีเมล: user@example.com                                │     |
|  │                                                         │     |
|  │  สถานะ:                                                 │     |
|  │  [○] เปิดใช้งาน                                         │     |
|  │  [●] ระงับชั่วคราว                                      │     |
|  │                                                         │     |
|  │  [ยกเลิก]              [บันทึก]                          │     |
|  │                                                         │     |
|  └─────────────────────────────────────────────────────────┘     |
+-------------------------------------------------------------------+
```

**Path API:**
- `PUT /api/users/{userId}/status`

**Request:**
```json
{
  "is_suspended": true  // หรือ false
}
```

**ผลลัพธ์:**
- ผู้ใช้ที่ถูกระงับจะไม่สามารถเข้าสู่ระบบได้
- ข้อมูลและธุรกิจของผู้ใช้ยังคงอยู่
- สามารถเปิดใช้งานได้อีกครั้ง

⚠️ **คำเตือน:**
- ⚠️ **Admin หลักไม่สามารถระงับตัวเองได้**
- ⚠️ **การระงับอาจส่งผลต่อธุรกิจที่ผูกกับบัญชีนั้น**
- ⚠️ **ควรแจ้งผู้ใช้ก่อนระงับบัญชี**

#### 3.2.4 การลบผู้ใช้

**ขั้นตอน:**

1. หาผู้ใช้ที่ต้องการลบ
2. คลิกปุ่ม **"ลบ"** (ไอคอน 🗑️)
3. ระบบแสดงข้อความยืนยัน:

```
+-------------------------------------------------------------------+
|                    ⚠️ ยืนยันการลบ                                  |
|                                                                   |
|  คุณต้องการลบผู้ใช้ "user@example.com" หรือไม่?                    |
|                                                                   |
|  ⚠️ การกระทำนี้จะ:                                                |
|  • ลบข้อมูลผู้ใช้ทั้งหมด                                          |
|  • ลบประวัติการใช้งาน                                            |
|  • ธุรกิจที่ผูกกับบัญชีนี้จะไม่มีเจ้าของ                           |
|                                                                   |
|  การกระทำนี้ไม่สามารถยกเลิกได้!                                   |
|                                                                   |
|           [ยกเลิก]              [ลบ]                              |
+-------------------------------------------------------------------+
```

4. คลิก **"ลบ"** เพื่อยืนยัน

**Path API:**
- `DELETE /api/users/{userId}`

⚠️ **คำเตือนร้ายแรง:**
- ⚠️⚠️⚠️ **ห้ามลบ Admin หลัก**
- ⚠️⚠️ **การลบผู้ใช้ไม่สามารถกู้คืนได้**
- ⚠️ **ควรสำรองข้อมูลก่อนลบ**
- ⚠️ **ตรวจสอบว่าผู้ใช้ไม่มีธุรกิจสำคัญก่อนลบ**

#### 3.2.5 การดูรายละเอียดผู้ใช้

**ขั้นตอน:**

1. หาผู้ใช้ที่ต้องการดูรายละเอียด
2. คลิกที่ชื่อหรืออีเมล (ถ้ามีลิงก์) หรือปุ่ม "ดูรายละเอียด"
3. ดูข้อมูล:

**ข้อมูลที่แสดง:**
- อีเมล
- ชื่อ-นามสกุล
- สิทธิ์ (Role)
- สถานะ
- วันที่สร้างบัญชี
- จำนวนธุรกิจที่เกี่ยวข้อง
- ประวัติการใช้งาน (ถ้ามี)

**Path API:**
- `GET /api/users/{userId}`

---

## 4. จัดการแพ็กเกจ (Admin เท่านั้น)

### 4.1 หน้าจัดการแพ็กเกจ

```
+-------------------------------------------------------------------+
|  📦 จัดการแพ็กเกจ                          [+ เพิ่มแพ็กเกจ]         |
|  ┌─────────────────────────────────────────────────────────┐     |
|  │ ชื่อแพ็กเกจ  │ ราคา  │ อัตรา/นาที │ สถานะ │ การจัดการ  │     |
|  ├──────────────┼───────┼───────────┼───────┼────────────│     |
|  │ Premium      │ 999฿  │ ไม่จำกัด   │ ✅    │ [แก้] [ลบ] │     |
|  │ Standard     │ 599฿  │ ไม่จำกัด   │ ✅    │ [แก้] [ลบ] │     |
|  │ Free         │ 0฿    │ ไม่จำกัด   │ ✅    │ [แก้] [ลบ] │     |
|  └──────────────┴───────┴───────────┴───────┴────────────┘     |
+-------------------------------------------------------------------+
```

### 4.2 ฟีเจอร์การจัดการแพ็กเกจ

#### 4.2.1 การเพิ่มแพ็กเกจ

**ขั้นตอน:**

1. คลิกปุ่ม **"+ เพิ่มแพ็กเกจ"**
2. กรอกข้อมูล:

```
+-------------------------------------------------------------------+
|                  เพิ่มแพ็กเกจใหม่                                   |
|  ┌─────────────────────────────────────────────────────────┐     |
|  │                                                         │     |
|  │  ชื่อแพ็กเกจ *:                                         │     |
|  │  [_________________________________________]             │     |
|  │  (เช่น: Premium, Standard, Free)                         │     |
|  │                                                         │     |
|  │  ราคา (บาท) *:                                          │     |
|  │  [_________________________________________]             │     |
|  │  (เช่น: 999, 599, 0)                                    │     |
|  │                                                         │     |
|  │  อัตราการใช้งานต่อนาที:                                  │     |
|  │  [_________________________________________]             │     |
|  │  (เว้นว่างไว้สำหรับ "ไม่จำกัด")                           │     |
|  │                                                         │     |
|  │  คำอธิบาย:                                              │     |
|  │  [_________________________________________]             │     |
|  │  [_________________________________________]             │     |
|  │                                                         │     |
|  │  [ยกเลิก]              [บันทึก]                          │     |
|  │                                                         │     |
|  └─────────────────────────────────────────────────────────┘     |
+-------------------------------------------------------------------+
```

**Path API:**
- `POST /api/packages`
- ต้องมี Authorization Header และ Role: `admin`

**ตัวอย่าง Request:**
```json
{
  "name": "Premium",
  "price": 999,
  "requests_per_minute": null,
  "description": "แพ็กเกจพรีเมียมสำหรับธุรกิจขนาดใหญ่ รองรับการแสดงผลลำดับต้น"
}
```

**ข้อมูลที่ต้องกรอก:**
- **ชื่อแพ็กเกจ** (บังคับ): เช่น Premium, Standard, Free
- **ราคา** (บังคับ): ราคาในหน่วยบาท
- **อัตราการใช้งานต่อนาที**: จำนวนคำถามที่อนุญาตต่อนาที (null = ไม่จำกัด)
- **คำอธิบาย**: รายละเอียดแพ็กเกจ

#### 4.2.2 การแก้ไขแพ็กเกจ

**ขั้นตอน:**

1. หาแพ็กเกจที่ต้องการแก้ไข
2. คลิกปุ่ม **"แก้ไข"**
3. แก้ไขข้อมูล
4. คลิก **"บันทึก"**

**Path API:**
- `PUT /api/packages/{packageId}`

⚠️ **คำเตือนสำคัญ:**
- ⚠️ **การแก้ไขราคาจะส่งผลต่อผู้ใช้ที่ใช้แพ็กเกจนี้**
- ⚠️ **ควรแจ้งผู้ใช้ล่วงหน้าก่อนแก้ไข**
- ⚠️ **การแก้ไขอัตราการใช้งานจะส่งผลทันที**
- ⚠️ **แพ็กเกจ Free ไม่ควรแก้ไขราคาเป็นค่าอื่น**

#### 4.2.3 การลบแพ็กเกจ

**ขั้นตอน:**

1. หาแพ็กเกจที่ต้องการลบ
2. คลิกปุ่ม **"ลบ"**
3. ระบบจะตรวจสอบว่ามีผู้ใช้ใช้แพ็กเกจนี้หรือไม่
4. ถ้ามีผู้ใช้ ระบบจะไม่อนุญาตให้ลบ:

```
+-------------------------------------------------------------------+
|              ⚠️ ไม่สามารถลบแพ็กเกจได้                              |
|                                                                   |
|  แพ็กเกจ "Premium" มีผู้ใช้ใช้งานอยู่:                             |
|  • sponsor@example.com (3 ธุรกิจ)                                |
|  • sponsor2@example.com (2 ธุรกิจ)                               |
|                                                                   |
|  กรุณาย้ายผู้ใช้ทั้งหมดไปแพ็กเกจอื่นก่อนลบ                         |
|                                                                   |
|                    [ตกลง]                                        |
+-------------------------------------------------------------------+
```

**Path API:**
- `DELETE /api/packages/{packageId}`

⚠️ **คำเตือน:**
- ⚠️ **ไม่สามารถลบแพ็กเกจที่มีผู้ใช้ได้**
- ⚠️ **ต้องย้ายผู้ใช้ทั้งหมดไปแพ็กเกจอื่นก่อน**
- ⚠️ **การลบแพ็กเกจไม่สามารถกู้คืนได้**
- ⚠️ **แพ็กเกจ Free ไม่ควรถูกลบ**

---

## 5. จัดการธุรกิจ

Admin มีสิทธิ์จัดการธุรกิจเหมือน Staff ทุกอย่าง (ดูรายละเอียดในคู่มือ "ผู้ช่วยผู้ดูแลระบบ")

**ฟีเจอร์ที่ทำได้:**
- ✅ เพิ่มธุรกิจ
- ✅ แก้ไขธุรกิจ
- ✅ ลบธุรกิจ
- ✅ จัดการรูปภาพธุรกิจ
- ✅ สร้าง Embedding

⚠️ **หมายเหตุ:** เนื่องจากมีรายละเอียดอยู่แล้วในคู่มือ "ผู้ช่วยผู้ดูแลระบบ" ดูรายละเอียดเพิ่มเติมได้ที่นั่น

---

## 6. สลิปการชำระเงิน

Admin มีสิทธิ์จัดการสลิปการชำระเงินเหมือน Staff ทุกอย่าง (ดูรายละเอียดในคู่มือ "ผู้ช่วยผู้ดูแลระบบ")

**ฟีเจอร์ที่ทำได้:**
- ✅ ดูสลิปทั้งหมด
- ✅ อนุมัติสลิป
- ✅ ปฏิเสธสลิป
- ✅ กรองตามสถานะ

---

## 7. การจัดการรูปภาพธุรกิจ

Admin มีสิทธิ์จัดการรูปภาพเหมือน Staff ทุกอย่าง (ดูรายละเอียดในคู่มือ "ผู้ช่วยผู้ดูแลระบบ")

---

## 8. การตั้งค่าระบบ

### 8.1 การเข้าถึงการตั้งค่าระบบ

Admin สามารถเข้าถึงการตั้งค่าระบบผ่าน Admin Panel

**การตั้งค่าที่สำคัญ:**

1. **Rate Limiting**
   - จำนวนคำถามที่อนุญาตต่อนาทีต่อผู้ใช้
   - การตั้งค่า Rate Limit ตาม Role

2. **Package Configuration**
   - การตั้งค่าแพ็กเกจต่างๆ
   - ราคาและสิทธิ์ของแต่ละแพ็กเกจ

3. **System Settings**
   - การตั้งค่า Embedding Service
   - การตั้งค่า LLM API
   - การตั้งค่า Database

⚠️ **หมายเหตุ:** การตั้งค่าระบบส่วนใหญ่ทำผ่าน Backend Configuration และ Docker Compose ไม่ใช่ผ่าน Web Interface

### 8.2 การตรวจสอบ Logs

**ผ่าน Terminal:**

```bash
# ดู Logs ของ API
docker logs vit-llm-chat-api-1 -f

# ดู Logs ของ Database
docker logs vit-llm-chat-database-1 -f

# ดู Logs ทั้งหมด
docker-compose -f docker-compose.prod.yml logs -f
```

---

## 9. การสร้าง Embedding

Admin มีสิทธิ์สร้าง Embedding เหมือน Staff (ดูรายละเอียดในคู่มือ "ผู้ช่วยผู้ดูแลระบบ")

**เพิ่มเติมสำหรับ Admin:**

สามารถสร้าง Embedding สำหรับธุรกิจทั้งหมดพร้อมกันผ่าน Script:

```bash
# ภายใน Container API
docker exec vit-llm-chat-api-1 node /path/to/batch-embedding.js
```

---

## 10. การสำรองและกู้คืนข้อมูล

### 10.1 การสำรองข้อมูล

**สำรอง Database:**

```bash
# สำรอง Database ทั้งหมด
docker exec vit-llm-chat-database-1 pg_dump -U postgres llmchat_db > backup_$(date +%Y%m%d).sql

# สำรองเฉพาะ Tables สำคัญ
docker exec vit-llm-chat-database-1 pg_dump -U postgres -t businesses -t users llmchat_db > partial_backup.sql
```

**สำรองไฟล์:**

```bash
# สำรองไฟล์รูปภาพ
tar -czf images_backup_$(date +%Y%m%d).tar.gz /path/to/uploads/

# สำรองไฟล์ Config
tar -czf config_backup_$(date +%Y%m%d).tar.gz /home/vit/docker-compose*.yml
```

### 10.2 การกู้คืนข้อมูล

**กู้คืน Database:**

```bash
# กู้คืนจากไฟล์ Backup
docker exec -i vit-llm-chat-database-1 psql -U postgres llmchat_db < backup_20250101.sql
```

⚠️ **คำเตือน:**
- ⚠️ **การกู้คืนจะเขียนทับข้อมูลที่มีอยู่**
- ⚠️ **ควรหยุดบริการก่อนกู้คืน**
- ⚠️ **ทดสอบการกู้คืนในระบบทดสอบก่อน**

---

## 11. การจัดการ Transaction

Admin สามารถจัดการ Transaction เหมือน Staff (ดูรายละเอียดในคู่มือ "ผู้ช่วยผู้ดูแลระบบ")

**API Paths:**
- `GET /api/transactions` - ดึงรายการ Transaction ทั้งหมด
- `PUT /api/transactions/{id}/status` - อัปเดตสถานะ Transaction

---

## 12. คำสั่งและ Path ที่เกี่ยวข้อง

### 12.1 API Endpoints สำหรับ Admin

**ผู้ใช้ (Users) - Admin เท่านั้น:**
```
GET    /api/users                         - ดึงรายการผู้ใช้ทั้งหมด
GET    /api/users/:userId                 - ดึงข้อมูลผู้ใช้
POST   /api/users                         - สร้างผู้ใช้ใหม่
PUT    /api/users/:userId                 - แก้ไขผู้ใช้
PUT    /api/users/:userId/status          - ระงับ/เปิดใช้งาน
DELETE /api/users/:userId                 - ลบผู้ใช้
```

**แพ็กเกจ (Packages) - Admin เท่านั้น:**
```
POST   /api/packages                      - สร้างแพ็กเกจใหม่
PUT    /api/packages/:id                  - แก้ไขแพ็กเกจ
DELETE /api/packages/:id                  - ลบแพ็กเกจ
```

**อื่นๆ:**
- เหมือน Staff ทุกอย่าง (ดูคู่มือ "ผู้ช่วยผู้ดูแลระบบ")

### 12.2 File Paths ที่สำคัญ

**Configuration:**
- `/home/vit/docker-compose.prod.yml` - Docker Compose สำหรับ Production
- `/home/vit/docker-compose.dev.yml` - Docker Compose สำหรับ Development

**Backend:**
- `/home/vit/llm-chat-backend/src/routes/user.routes.js` - Routes สำหรับผู้ใช้
- `/home/vit/llm-chat-backend/src/routes/package.routes.js` - Routes สำหรับแพ็กเกจ
- `/home/vit/llm-chat-backend/src/controllers/user.controller.js` - Controller สำหรับผู้ใช้

**Database:**
- Database Name: `llmchat_db`
- Tables: `users`, `packages`, `businesses`, `business_packages`, `payment_slips`, `transactions`

### 12.3 คำสั่ง Docker ที่สำคัญ

```bash
# ดู Logs
docker logs vit-llm-chat-api-1 -f

# Restart Service
docker restart vit-llm-chat-api-1

# เข้าไปใน Container
docker exec -it vit-llm-chat-api-1 bash
docker exec -it vit-llm-chat-database-1 psql -U postgres -d llmchat_db

# Backup Database
docker exec vit-llm-chat-database-1 pg_dump -U postgres llmchat_db > backup.sql

# Restore Database
docker exec -i vit-llm-chat-database-1 psql -U postgres llmchat_db < backup.sql
```

### 12.4 คำสั่ง SQL ที่สำคัญ

```sql
-- ดูผู้ใช้ทั้งหมด
SELECT id, email, role, is_suspended, created_at FROM users ORDER BY created_at DESC;

-- ดูแพ็กเกจทั้งหมด
SELECT id, name, price, requests_per_minute FROM packages;

-- ดูผู้ใช้ที่ใช้แพ็กเกจ
SELECT u.email, p.name as package_name, COUNT(bp.business_id) as business_count
FROM users u
LEFT JOIN business_packages bp ON u.id = bp.user_id
LEFT JOIN packages p ON bp.package_id = p.id
GROUP BY u.email, p.name;

-- ดู Admin ทั้งหมด
SELECT id, email, first_name, last_name, created_at FROM users WHERE role = 'admin';

-- ระงับผู้ใช้
UPDATE users SET is_suspended = true WHERE email = 'user@example.com';

-- เปิดใช้งานผู้ใช้
UPDATE users SET is_suspended = false WHERE email = 'user@example.com';
```

---

## 13. คำเตือนและข้อควรระวังสำหรับ Admin

### 13.1 คำเตือนเกี่ยวกับการจัดการผู้ใช้

⚠️⚠️⚠️ **ห้ามทำ:**
- ⚠️⚠️⚠️ **ห้ามลบ Admin หลัก** (admin@example.com)
- ⚠️⚠️ **ห้ามระงับ Admin หลัก**
- ⚠️⚠️ **ห้ามเปลี่ยนสิทธิ์ Admin หลักเป็นอย่างอื่น**
- ⚠️ **ห้ามสร้าง Admin มากเกินไป** (ควรมี Admin หลัก 1-2 คน)

⚠️ **ควรระวัง:**
- ตรวจสอบให้แน่ใจก่อนลบหรือระงับผู้ใช้
- ไม่ควรเปลี่ยนสิทธิ์ของผู้ใช้โดยไม่จำเป็น
- บันทึกเหตุผลทุกครั้งที่ทำการเปลี่ยนแปลงสิทธิ์

### 13.2 คำเตือนเกี่ยวกับการจัดการแพ็กเกจ

⚠️⚠️⚠️ **ห้ามทำ:**
- ⚠️⚠️⚠️ **ห้ามลบแพ็กเกจ Free**
- ⚠️⚠️ **ห้ามแก้ไขแพ็กเกจที่มีผู้ใช้จำนวนมากโดยไม่แจ้ง**
- ⚠️ **ห้ามเปลี่ยนราคาแพ็กเกจ Free เป็นค่าอื่น**

⚠️ **ควรระวัง:**
- แจ้งผู้ใช้ล่วงหน้าก่อนแก้ไขแพ็กเกจ
- ตรวจสอบจำนวนผู้ใช้ก่อนลบแพ็กเกจ
- ไม่ควรเปลี่ยนราคาแพ็กเกจบ่อยเกินไป

### 13.3 คำเตือนเกี่ยวกับความปลอดภัย

⚠️⚠️⚠️ **ความปลอดภัย:**

1. **ข้อมูลการเข้าสู่ระบบ:**
   - ⚠️ **ห้ามแชร์ข้อมูลการเข้าสู่ระบบ Admin กับใคร**
   - ⚠️ **ใช้รหัสผ่านที่แข็งแรง** (ขั้นต่ำ 12 ตัวอักษร, มีตัวอักษรใหญ่-เล็ก, ตัวเลข, สัญลักษณ์)
   - ⚠️ **เปลี่ยนรหัสผ่านเป็นระยะ** (ทุก 3-6 เดือน)

2. **การเข้าถึงระบบ:**
   - ⚠️ **ออกจากระบบทุกครั้งเมื่อเสร็จสิ้น**
   - ⚠️ **อย่า Login บนคอมพิวเตอร์ที่ไม่ปลอดภัย**
   - ⚠️ **ตรวจสอบ Log การเข้าสู่ระบบเป็นประจำ**

3. **การสำรองข้อมูล:**
   - ⚠️ **สำรองข้อมูลเป็นประจำ** (แนะนำทุกวัน)
   - ⚠️ **เก็บ Backup ไว้หลายที่**
   - ⚠️ **ทดสอบการกู้คืนข้อมูลเป็นระยะ**

### 13.4 คำเตือนเกี่ยวกับการเปลี่ยนแปลงระบบ

⚠️ **ควรทำ:**
- ✅ ทดสอบการเปลี่ยนแปลงในระบบทดสอบก่อน
- ✅ แจ้งผู้ใช้ก่อนเปลี่ยนแปลงที่สำคัญ
- ✅ บันทึกการเปลี่ยนแปลงทั้งหมด
- ✅ สำรองข้อมูลก่อนทำการเปลี่ยนแปลงใหญ่

⚠️ **ไม่ควรทำ:**
- ❌ เปลี่ยนแปลงระบบโดยไม่วางแผน
- ❌ ทำการเปลี่ยนแปลงหลายอย่างพร้อมกัน
- ❌ เปลี่ยนแปลงใน Production โดยไม่ทดสอบ

### 13.5 Checklist สำหรับ Admin

**ก่อนเริ่มงานทุกวัน:**
- [ ] Login เข้าสู่ระบบ
- [ ] ตรวจสอบ Logs เพื่อดู Error
- [ ] ตรวจสอบสถานะ Services (Docker)
- [ ] ตรวจสอบสลิปการชำระเงินที่รอการตรวจสอบ

**ประจำสัปดาห์:**
- [ ] สำรองข้อมูล Database
- [ ] ตรวจสอบจำนวนผู้ใช้และธุรกิจ
- [ ] ตรวจสอบ Logs การใช้งาน
- [ ] ทบทวนการเปลี่ยนแปลงที่ทำไป

**ประจำเดือน:**
- [ ] ทดสอบการกู้คืนข้อมูล
- [ ] ตรวจสอบความปลอดภัย
- [ ] เปลี่ยนรหัสผ่าน (ถ้าจำเป็น)
- [ ] ทบทวนสิทธิ์ของผู้ใช้

---

## 14. การขอความช่วยเหลือ

หากพบปัญหาหรือต้องการความช่วยเหลือ:
1. ตรวจสอบ Logs: `docker logs vit-llm-chat-api-1 -f`
2. ตรวจสอบ Database: `docker exec -it vit-llm-chat-database-1 psql -U postgres -d llmchat_db`
3. ทบทวนการเปลี่ยนแปลงล่าสุด
4. ติดต่อทีมพัฒนา (ถ้ามี)

---

## สรุป

Admin มีสิทธิ์เต็มที่ในการจัดการระบบทั้งหมด รวมถึง:

✅ **การจัดการผู้ใช้** - สร้าง/แก้ไข/ลบ/ระงับผู้ใช้ทั้งหมด  
✅ **การจัดการแพ็กเกจ** - สร้าง/แก้ไข/ลบแพ็กเกจ  
✅ **การจัดการธุรกิจ** - ทุกฟีเจอร์เหมือน Staff  
✅ **การจัดการสลิป** - ทุกฟีเจอร์เหมือน Staff  
✅ **การตั้งค่าระบบ** - ตรวจสอบและปรับแต่งระบบ  

**URL:**
- Admin Panel: `https://frontend.sri-ketguide.com/#/admin`

**บัญชี Admin:**
- อีเมล: `admin@example.com`
- รหัสผ่าน: `1234`
- สิทธิ์: `admin` (สิทธิ์เต็มที่)

⚠️ **คำเตือนสำคัญ:**
- Admin มีสิทธิ์เต็มที่ ควรใช้งานด้วยความระมัดระวัง
- ห้ามลบหรือเปลี่ยนแปลง Admin หลัก
- สำรองข้อมูลเป็นประจำ
- ใช้รหัสผ่านที่แข็งแรง

---

**อัปเดตล่าสุด:** ตุลาคม 2568  
**เวอร์ชัน:** 1.0

